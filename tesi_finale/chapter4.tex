\chapter{Numerical results} \label{chap:results}
In this chapter we present some numerical results. The convergence of higher 
order methods applied to the Navier-Stokes equations is tested, first in space, 
then in time. Then another spatial comparison test between the upwind method 
and the TVD methods is performed using a channel flow. After that the results 
from the backward facing step test using the RANS equations are shown and 
compared to those from the CFL3D code \cite{web:nasa}. Next, a turbulent 
channel flow with two small cavities is studied and at last it is coupled
with a porous-medium flow, analysing the several values of permeability of the porous-medium.
%
\section{Navier-Stokes tests}
\subsection{Space convergence} \label{subsec:conv}
We want to test the spatial convergence order of the $L^2$-error of the 
solution of the Navier-Stokes equations, comparing the results obtained with 
the upwind method \eqref{eq:upwind} and the TVD methods described in 
Subsection~\ref{subsec:tvd}.\\
We consider a steady version of the 
equations~\eqref{eq:nsmass}--\eqref{eq:nsmom}:
\begin{align}
	\label{eq:nssteadymass} \nabla \cdot \mathbf{v} -h = 0&\\
	\label{eq:nssteadymom} \nabla \cdot (\mathbf{v} \mathbf{v}^\mathrm{T}) - 
	\nabla \cdot (\nu \nabla \mathbf{v}) + \frac{1}{\varrho}\nabla p  
	-\mathbf{f} = \mathbf{0}&
\end{align}
We neglect the gravity, but we take into account two possible source terms 
$h$ and $\mathbf{f}$. Moreover, for the sake of simplicity, we consider here 
all the quantities appearing in the equations to be non-dimensional.
%
\subsubsection{Sin-Cos test}
Let us solve the equations~\eqref{eq:nssteadymass}--\eqref{eq:nssteadymom} over 
a two-dimensional unit domain $\Omega=(0,1)^2$, with the following source terms:
\begin{align}
	h &= 0,\\
	\mathbf{f} &= [-2\nu \cos(x) \sin(y), \; 2\nu \cos(y) \sin(x)]^\mathrm{T},
\end{align}
so that, choosing $\varrho=1$, the analytical solution, depicted in 
Figure~\ref{fig:sincosexact}, is given by
\begin{align}
\label{eq:uexsin}	u_\text{ex}(x,y) &= -\cos(x)\sin(y)\\
	v_\text{ex}(x,y) &= \sin(x)\cos(y)\\
\label{eq:pexsin}	p_\text{ex}(x,y) &= -\frac{\cos(2x)+\sin(2y)}{4}
\end{align}
Dirichlet boundary conditions for the velocity are applied on the whole 
boundary $\partial \Omega$ using the exact solution. Because of this choice, 
the pressure appears in the problem only in the momentum equation 
\eqref{eq:nssteadymom}, under the sign of gradient. Thus in the numerical 
solution it would be defined up to a constant, so we fix its value at one point 
in the domain in order to match the exact solution \eqref{eq:pexsin}.
\begin{figure}
	\centering
	\subfloat{\includegraphics[width=0.5\textwidth]{sincos_exact_v_report.png}}
	\subfloat{\includegraphics[width=0.5\textwidth]{sincos_exact_p_report.png}}
	\caption[Exact solution of the Sin-Cos test]{Exact solution of the Sin-Cos 
	test \eqref{eq:uexsin}--\eqref{eq:pexsin}. On the left the magnitude of the 
	velocity field, on the right the 
	pressure field.}
	\label{fig:sincosexact}
\end{figure}

The problem is solved over a sequence of five uniform grids, starting from 
$\num{4x4}$ cells and each time halving their size. Both the cases of $\nu=1$ 
and $\nu=\num{e-3}$ are considered, that correspond to $Re=1$ and $Re=\num{e3}$ 
respectively. In Figure~\ref{fig:sin_err} the errors computed are reported 
depending on the square root of the number of cells, while in 
Tables~\ref{tab:sin_lre}--\ref{tab:sin_hre} we can compare directly the 
convergence orders for the different differencing schemes.
\begin{figure}
	\centering
	\subfloat[Upwind, $Re = 1$]{
		\input{../img/l2error_test_navierstokes_sincos}}
	\subfloat[Upwind, $Re = \num{e3}$]{
		\input{../img/l2error_test_navierstokes_sincos_hre}}\\
	\subfloat[Min-Mod, $Re = 1$]{
		\input{../img/l2error_test_navierstokes_sincos_mm}}
	\subfloat[Min-Mod, $Re = \num{e3}$]{
		\input{../img/l2error_test_navierstokes_sincos_mm_hre}}\\
	\subfloat[Van Leer, $Re = 1$]{
		\input{../img/l2error_test_navierstokes_sincos_vl}}
	\subfloat[Van Leer, $Re = \num{e3}$]{
		\input{../img/l2error_test_navierstokes_sincos_vl_hre}}
	\caption[$L^2$-errors for the Sin-Cos test]{$L^2$-errors for the Sin-Cos 
	test depending on the square root of the number of cells in the grid. 
	The grey lines are the reference lines for the first-order and second-order 
	convergence.}
	\label{fig:sin_err}
\end{figure}

\begin{table}
	\centering
	\[
	\begin{array}{c|ccc}
	\toprule
	& \text{Upwind} & \text{Min-Mod} & \text{Van Leer} \\ 
	\midrule
	p & 1.008 & 1.569 & 1.626\\
	v_x & 1.143 & 1.962 & 1.977\\
	v_y & 1.058 & 1.928 & 1.945\\
	\bottomrule
	\end{array}
	\]
	\caption[Convergence orders with $Re = 1$ for the Sin-Cos 
	test]{Convergence orders with $Re = 1$ for the Sin-Cos test. They are 
	computed considering the last two refinements of the grid.}
	\label{tab:sin_lre}
	\[
	\begin{array}{c|ccc}
	\toprule
	& \text{Upwind} & \text{Min-Mod} & \text{Van Leer} \\ 
	\midrule
	p & 1.148 & 1.659 & 1.058\\
	v_x & 1.071 & 1.441 & 1.437\\
	v_y & 1.068 & 1.533 & 1.560\\
	\bottomrule
	\end{array}
	\]
	\caption[Convergence orders with $Re = \num{e3}$ for the Sin-Cos 
	test]{Convergence orders with $Re = \num{e3}$ for the Sin-Cos test. 
	They are computed considering the last two refinements of the grid.}
	\label{tab:sin_hre}
\end{table}

We observe, as expected, a better behaviour of the TVD methods with respect to 
the upwind method. In Table~\ref{tab:sin_lre} we can see that at $Re=1$ the 
formers show a full second order convergence for the velocity, while for the 
rate is a bit lower; the latter instead shows a first for all the variables. At 
$Re=\num{e3}$ a slight decrease of the rates of the TVD methods occurs also for 
the velocities, but they remain higher then the ones of the upwind method. In 
Table~\ref{tab:sin_hre} we observe a convergence order of 1 for the pressure 
using the Van Leer flux limiter, but looking at Figure~\ref{fig:sin_err} we can 
see that the global trend indicates a convergence of higher order. Moreover it 
can be observed how, thanks to the faster convergence, on the same grid the 
absolute values of the errors reach smaller values using the TVD methods. 
Between the Min-Mod and Van Leer flux limiter it is hard to say which performs 
better, the results are very similar.

Analogous tests with other analytical solutions are reported in the 
Appendix~\ref{app:conv}. They show always a better convergence of the TVD 
methods with respect to the upwind method, but in some cases the convergence 
order of pressure and velocity behave differently.
%
\subsection{Time convergence}
We test the time convergence of the $L^\infty(0,T;L^2(\Omega))$ norm of the 
error of the solution of the Navier-Stokes equations, comparing the results 
obtained with the BE method \eqref{eq:be} and the BDF2 method \eqref{eq:bdf2}.\\
We consider the unsteady version of the 
equations~\eqref{eq:nssteadymass}--\eqref{eq:nssteadymom}:
\begin{align}
	\label{eq:nsunsteadymass} \nabla \cdot \mathbf{v} -h = 0&\\
	\label{eq:nsunsteadymom} \frac{\partial \mathbf{v}}{\partial t} +\nabla 
	\cdot (\mathbf{v} \mathbf{v}^\mathrm{T}) - 
	\nabla \cdot (\nu \nabla \mathbf{v}) + \frac{1}{\varrho}\nabla p  
	-\mathbf{f} = \mathbf{0}&
\end{align}
Again the gravity is neglected and two possible sources $h$ and $\mathbf{f}$ 
are taken into account, moreover all the quantities are considered to be 
non-dimensional.
%
\subsubsection{Unsteady Sin-Cos test}
Let us solve the equations~\eqref{eq:nsunsteadymass}--\eqref{eq:nsunsteadymom} 
over a two dimensional unit domain $\Omega=(0,1)^2$ and in the time interval 
$(0,T)$, with $T=1$. We use the following source terms:
\begin{align}
h &= 0,\\
\mathbf{f} &= 2\Big(\frac{\cos(2t)}{\varrho} + \nu \sin(2t)\Big)[- \cos(x) 
\sin(y), \; 
\cos(y) \sin(x)]^\mathrm{T},
\end{align}
so that, choosing $\varrho=1$, the analytical solution is given by
\begin{align}
\label{eq:uexunssin}	u_\text{ex}(x,y) &= -\cos(x)\sin(y)\sin(2t)\\
v_\text{ex}(x,y) &= \sin(x)\cos(y)\sin(2t)\\
\label{eq:pexunssin}	p_\text{ex}(x,y) &= 
-\frac{\cos(2x)+\sin(2y)}{4}\sin^2(2t),
\end{align}
so it is equal to \eqref{eq:uexsin}--\eqref{eq:pexsin}, used in the steady test 
for the space convergence, except for the modulation over time. We choose 
$\nu=0.1$, so that $Re=10$. Dirichlet boundary conditions for the velocity are 
applied on the whole boundary $\partial \Omega$ using the exact solution. 
Pressure is again fixed  at one point in order to match the exact solution 
\eqref{eq:pexunssin}.

The problem is solved seven times subdividing the time interval $(0,T)$ into 
uniform time-steps and each time time doubling their number, starting from a 
single time-step. Uniform grids of $\num{40x40}$ and $\num{80x80}$ cells are 
employed and as a differencing scheme the TVD method with the Van Leer flux 
limiter \eqref{eq:vl} is used. From Figure~\ref{fig:timeerr} we observe that, 
as expected, the BE method shows a first-order convergence, while the BDF2 
method is of second order. Moreover we notice that, with a grid of 
$\num{40x40}$ cells, in the last refinement the error with the BDF2 method does 
not decrease anymore. This happens because the spatial error becomes 
dominant, indeed refining the grid the convergence order is restored entirely 
for the pressure and almost for the velocity.
\begin{figure}
	\centering
	\subfloat{\input{../img/time_convergence_p_report}}
	\subfloat{\input{../img/time_convergence_v_report}}
	\caption[$L^\infty(0,T;L^2(\Omega))$-errors for the unsteady Sin-Cos 
	test]{$L^\infty(0,T;L^2(\Omega))$-errors for the unsteady Sin-Cos test 
	depending on the number of time-steps. On the left the errors for the 
	pressure, on the right the error for the magnitude of the velocity. The 
	grey lines are the reference lines for the first-order and second-order 
	convergence.}
	\label{fig:timeerr}
\end{figure}
%
\subsection{Rough channel test} \label{subsec:roughchannel}
We test the behaviour of the TVD methods compared to the upwind method solving 
the unsteady Navier-Stokes equations \eqref{eq:nsmass}--\eqref{eq:nsmom} in 
a two-dimensional channel with a rough (i.e. non-flat) lower boundary. The 
roughness consists of small evenly spaced cavities. Two different 
configurations are studied, one with shallow cavities, depicted in 
Figure~\ref{fig:roughdom}, and another with deeper cavities, depicted in 
Figure~\ref{fig:roughdomdeep}.

On the left boundary $\Gamma_\text{in}$ we set inflow boundary conditions 
\eqref{eq:inflow}, specifying an horizontal velocity
\begin{equation}
	\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad 
	u_\text{in} = \SI{1}{m/s}.
\end{equation}
On the lower and upper boundaries $\Gamma_w$ we set no-slip boundary conditions 
\eqref{eq:noslip}, while on the right boundary $\Gamma_\text{out}$ we set 
outflow boundary conditions \eqref{eq:outflow}, fixing the value of the pressure
\begin{equation}
	p = p_\text{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
As initial conditions the velocity is set to zero everywhere, while the 
pressure is set to $p_\text{ext}$ everywhere. The density is 
$\varrho=\SI{1}{kg/m^3}$. The gravity contribution in \eqref{eq:nsmom} is 
neglected.
%
\subsubsection{Shallow cavities}
In the case of shallow cavities we use the domain in Figure~\ref{fig:roughdom} 
and we employ a uniform grid of $\num{95x50}$ cells. The problem is then solved 
over the time interval [$0,T$], with $T=\SI{10}{s}$; the initial time-step is 
$\Delta t=\SI{5e-3}{s}$, then it is adapted as explained in 
Section~\ref{sec:algeq}, allowing a maximum time-step of $\SI{0.1}{s}$. 
At first we set $\nu=\SI{5e-4}{m^2/s}$, so that $Re=\num{2e3}$. Since we do not 
have an analytical solution for this problem, we compute a \emph{reference 
solution} using the upwind method over a grid six times finer.

In Figure~\ref{fig:linecompshallow} we compare the profiles of the magnitude 
of the velocity along a section near the end of the channel, at 
$x=\SI{8.75}{m}$, i.e. at the middle of the last cavity.  The TVD solutions 
match the reference one, while the upwind solution shows a small shift, 
especially in the lower part of the channel, above the cavity. So, on a coarse 
grid, we obtain a solution that is the one we would obtain with the upwind 
method on a finer grid. In Table~\ref{tab:errshallow} we can see the $L^2$-norm 
of the errors between the coarse solutions and the reference one, computed 
along the section. As expected, the one related to the upwind method is at 
least one order of magnitude larger than the others. 
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_domain2.pdf}
	\caption[Domain of the rough channel test with shallow cavities]{Domain of 
	the rough channel test with shallow cavities.}
	\label{fig:roughdom}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_channel_vl_report.png}
	\caption[Magnitude of the velocity magnitude in the rough channel test with 
	shallow cavities]{Magnitude of the velocity magnitude $[\si{m/s}]$ in the 
	rough channel test with shallow cavities at $t=\SI{10}{s}$. $Re=\num{2e3}$, 
	Van Leer flux limiter.}
	\label{fig:roughchannelvl}
\end{figure}
\begin{figure}
	\centering
	\input{../img/line_comparison}
	\caption[Profile of the magnitude of the velocity in the rough channel with 
	shallow cavities at $Re=\num{2e3}$]{Profile of the magnitude of the 
	velocity $[\si{m/s}]$ in the rough channel with shallow cavities along the 
	section $x=\SI{8.75}{m}$, at $t=\SI{10}{s}$. $Re=\num{2e3}$. The region on 
	the left of the dashed line is inside the cavity.}
	\label{fig:linecompshallow}
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{ccc}
	\toprule
	\text{Upwind} & \text{Van Leer} & \text{Van Alabada} \\
	\midrule
	\num{1.708e-4} & \num{9.556e-6} & \num{1.119e-5} \\
	\midrule
	\text{Min-Mod} & \text{Superbee} & \text{MC Limiter} \\
	\midrule
	\num{1.537e-5} &  \SI{8.335e-6} & \num{8.659e-6}\\
	\bottomrule
	\end{array}
	\]
	\caption[$L^2$-errors for the profile of the magnitude of the velocity in 
	the rough channel with shallow cavities at $Re=\num{2e3}$]{$L^2$-errors for 
	the profile of the magnitude of the velocity along a section at 
	$x=\SI{8.75}{m}$ and $t=\SI{10}{s}$ in the rough channel with shallow 
	cavities. $Re = \num{2e3}$.}
	\label{tab:errshallow}
\end{table}

We repeat the test choosing $\nu=\SI{1}{m^2/s}$, so that $Re=1$. In 
Figure~\ref{fig:linecompshallowlre} we see that all the solutions have the same 
profile, moreover in the cavity there is no recirculation. In 
Table~\ref{tab:errshallow_lre} the $L^2$-errors are reported; the upwind one is 
the bigger, but they are all very similar. So, in this situation of low $Re$, 
the benefit of using a high-resolution scheme is reduced.
\begin{figure}
	\centering
	\input{../img/line_comparison_lre}
	\caption[Profile of the magnitude of the velocity in the rough channel with 
	shallow cavities at $Re=1$]{Profile of the magnitude of the velocity 
	$[\si{m/s}]$ in the rough channel with shallow cavities along the section 
	$x=\SI{8.75}{m}$, at $t=\SI{5}{s}$. $Re=1$. The region on the left of the 
	dashed line is inside the cavity.}
	\label{fig:linecompshallowlre}
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{ccc}
	\toprule
	\text{Upwind} & \text{Van Leer} & \text{Van Alabada}\\
	\midrule
	\num{3.431e-6} & \num{2.917e-6} & \num{2.937e-6}\\
	\midrule
	\text{Min-Mod} & \text{Superbee} & \text{MC Limiter} \\ 
	\midrule
	\num{2.956e-6} & \num{2.899e-6} & \num{2.902e-6}\\
	\bottomrule
	\end{array}
	\]
	\caption[$L^2$-errors for the profile of the magnitude of the velocity in 
	the rough channel with shallow cavities at $Re=1$]{$L^2$-errors for the 
	profile of the magnitude of the velocity along a section at 
	$x=\SI{8.75}{m}$ and $t=\SI{5}{s}$ in the rough channel with shallow 
	cavities. $Re = 1$.}
	\label{tab:errshallow_lre}
\end{table}
%
\subsubsection{Deep cavities}
In the case of deep cavities we use the domain in Figure~\ref{fig:roughdomdeep} 
and we employ a uniform grid of $\num{95x70}$ cells. Again we solve until 
$T=\SI{10}{s}$, starting from an initial time-step of $\SI{e-3}{s}$. We set 
$\nu=\SI{5e-4}{m^2/s}$, so that $Re=\num{2.8e3}$. As before we compute a 
reference solution over a grid six times finer.

In Figure~\ref{fig:linecompdeep} we compare the profiles of the magnitude of 
the velocity along the section at $x=\SI{8.75}{m}$. Now the biggest differences 
are in the region inside the cavity, where the recirculation occurs. The upwind 
method, with its numerical diffusion, smooths the profile, while the TVD 
methods produce a more accurate result, even if they do not match exactly the 
reference solution. Indeed, looking at the $L^2$-errors reported in 
Table~\ref{tab:errdeep}, we see that the upwind has again the largest error, 
but the difference with the other schemes is reduced with respect to the 
previous case of shallow cavities.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_domain_highstep2.pdf}
	\caption[Domain of the rough channel test with deep cavities]{Domain of the 
	rough channel test with deep cavities.}
	\label{fig:roughdomdeep}
\end{figure}
\begin{figure}
	\centering
	\input{../img/line_comparison_highstep_report}
	\caption[Profile of the magnitude of the velocity in the rough channel with 
	deep cavities at $Re=\num{2.8e3}$]{Profile of the magnitude of the velocity 
		$[\si{m/s}]$ in the rough channel with deep cavities along the section 
		$x=\SI{8.75}{m}$, at $t=\SI{10}{s}$. $Re=\num{2.8e3}$. The region on 
		the 
		left of the dashed line is inside the cavity.}
	\label{fig:linecompdeep}
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{ccc}
	\toprule
	\text{Upwind} & \text{Van Leer} & \text{Van Alabada}\\
	\midrule
	\num{3.180e-4} & \num{5.862e-5} & \num{6.900e-5}\\
	\midrule
	\text{Min-Mod} & \text{Superbee} & \text{MC Limiter} \\
	\midrule
	\num{8.579e-5} & \num{7.883e-5} & \num{5.584e-5}\\
	\bottomrule
	\end{array}
	\]
	\caption[$L^2$-errors for the profile of the magnitude of the velocity in 
	the rough channel with deep cavities]{$L^2$-errors for the profile of the 
	magnitude of the velocity along a section at $x=\SI{8.75}{m}$ and 
	$t=\SI{10}{s}$ in the rough channel with deep cavities. $Re = \num{2.8e3}$.}
	\label{tab:errdeep}
\end{table}
%
\section{RANS test}
\subsection{Backward facing step}
The backward facing step is a widely-used test configuration, in which a turbulent flow in a channel incurs separation because of a sudden enlargement in the flow domain. As we can see in Figure~\ref{fig:bfsarrows}, there is a big recirculation after the step, a corner eddy and a very small eddy precisely at the corner. We want to use this test in order to compare the results that we obtain using the TVD method, with the Van Leer flux limiter \eqref{eq:vl}, and the $k\text{-}\omega$ turbulence model with the numerical results from \cite{web:nasa}, computed using the NASA CFL3D code, and the experimental results from \cite{bfs:driver}.

In the domain $\Omega$, depicted in Figure~\ref{fig:bfsdomain}, with a step height $H=\SI{1}{m}$, we solve the RANS equations \eqref{eq:ransmass}-\eqref{eq:ransmom}-\eqref{eq:komegak}-\eqref{eq:komegaomega}, imposing inflow boundary conditions on the left boundary $\Gamma_\text{in}$
\begin{equation}
	\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad u_\text{in} = \SI{44.2}{m/s},
\end{equation} no-slip boundary conditions on the lower and upper boundaries $\Gamma_w$ and outflow boundary conditions on the right boundary $\Gamma_\text{out}$, fixing the value of pressure
\begin{equation}
	p = p_\text{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
\begin{figure}
	\centering
%	\includegraphics[width=\textwidth]{bfs_domain.pdf}
	\includegraphics[width=\textwidth]{bfs_domain_axis.pdf}
	\caption[Domain of the backward facing step test]{Domain $\Omega$ of the backward facing step test. For convenience, we set the position $x=0$ at the step and the position $y=0$ at the bottom of the channel.}
	\label{fig:bfsdomain}
\end{figure}
The density is $\varrho = \SI{1}{kg/m^3}$ and the viscosity is $\nu=\SI{1.228e-3}{m^2/s}$, so that, in order to match \cite{web:nasa}, the Reynolds number based on the step height results
\begin{equation}
	Re_H = \frac{u_\text{in}H}{\nu} \simeq \num{3.6e4}.
\end{equation}

The domain sizes are chosen according to \cite{web:nasa}, with the only exception of the channel length before the step. Indeed, in \cite{web:nasa}, a small portion of the horizontal boundary near $\Gamma_\text{in}$ uses symmetry boundary conditions, but we simplify the model employing no-slip boundary conditions on the whole horizontal boundaries. As a consequence, we shorten the channel length in order to match as good as possible the profile of the $u$ component of the velocity along the section at the position $x/H=-4$, with a boundary layer thickness of approximately $1.5H$ (see Figure~\ref{fig:bfscomp}).

According to \cite{web:nasa}, CFL3D is a code for compressible fluids, but it was used at ``essentially incompressible'' conditions, such that the influence of compressibility should be very small. Moreover it is reported that, running unsteady simulations, the solution settles down and becomes reasonably steady (quasi-steady); in \cite{bfs:cfl3d} it is explained that implicit methods for ad advancement in time are used.

Thus we employ the BDF2 method for non-constant time-steps \eqref{eq:bdf2gen}, starting from $\Delta t = \SI{e-5}{s}$ and simulating until $T_\text{end} = \SI{30}{s}$. It can be observed that after approximately $t=\SI{20}{s}$ the solution stabilizes at a steady state. As initial conditions we set
\begin{equation}
p=p_\text{ext} \quad \forall \mathbf{x} \in \Omega, \quad \mathbf{v} = [u_\text{init},0]^\mathrm{T} \quad u_\text{init} = \begin{cases}
u_\text{in} \quad&\text{if $x\leq 0$}\\
\frac{8}{9}u_\text{in} \quad&\text{if $x>0$}
\end{cases}
\end{equation}
The factor $8/9$ ensures that the discharge at $\Gamma_\text{in}$ and at $\Gamma_\text{out}$ is the same. For $k$ and $\omega$ we set in the whole domain the values estimated with \eqref{eq:koic}.

According to \cite{web:nasa}, a key indicator for the reliability of a simulation is the prediction of the \emph{reattachment length} $l_\text{rea}$, i.e. the distance after the step at which the recirculation finishes and thus the $u$ component of the velocity at the bottom of the channel becomes positive. We analyse this length computing the \emph{friction coefficient} $C_f$, that is a non-dimensional form of the stress at the wall, and it is defined by:
\begin{equation}
C_f = \frac{\tau_w}{\frac{1}{2}\varrho U_\text{ref}^2}, \quad \tau_w = \mu \frac{\partial u}{\partial y} \Big|_{y=0}.
\end{equation}
$U_\text{ref}$ is the $u$ component of the velocity at $x/H=-4$ and it is the characteristic value that we use to produce non-dimensional results. In our case when $C_f<0$ the flow is recirculating, then at $x=l_{rea}$ it becomes positive. The numerical results from \cite{web:nasa} predict $l_\text{rea}/H \simeq 6.8$, while the experimental results from \cite{bfs:driver} predict $l_\text{rea}/H = 6.26 \pm 0.10$, as it can be seen in Figure~\ref{fig:bfscf}.

Performing a sensitivity analysis in order to choose a suitable grid, we observed that
\begin{itemize}
	\item with a coarse mesh the reattachment length decreases, in particular a refinement of the smallest cell in the $y$-direction in effective.
	\item too stretched cells increase the number of Newton iteration needed to get the convergence of the problem.
	\item the cells in portion of the channel after the step can be coarsened in the $x$-direction without a great influence on the solution.
	\item too refined cells in the $y$-direction in the area with the recirculation do not improve in a relevant way the solution.
\end{itemize}
So, for the following analysis, we choose a grid made of $\num{119x70}$ cells, employing gradings up to 1.25 in order to have small cells near the walls.

\begin{figure}[p] %mettere in paraview frecce 2d
	\centering
	\includegraphics[width=\textwidth]{bfs_glimphs2.png}
	\caption[Velocity field after the backward facing step]{Velocity field $[\si{m/s}]$ after the backward facing step. $Re_H=\num{3.6e4}$. The arrows are not scaled.}
	\label{fig:bfsarrows}
\end{figure}
\begin{figure}[p]
	\centering
	\input{../img/bfs_fin_cf_report}
	\caption[Friction coefficient in the backward facing step test]{Friction coefficient at the bottom of the channel after the backward facing step. The reattachment length is the distance at which it becomes positive after its global minimum.}
	\label{fig:bfscf}
\end{figure}

Fo what concerns the reattachment length, we obtain a good agreement with the CFL3D code, indeed, looking at Figure~\ref{fig:bfscf}, with the Van Leer flux limiter we predict $l_\text{rea} /H \simeq 6.67$. Moreover, in the whole recirculating region, the pattern is very similar, also compared the experimental data from \cite{bfs:driver}. Using the first order upwind methods, instead, it is $l_\text{rea} /H \simeq 6.02$, so approximately a 10\% underestimation occurs. From the profile is seems that the whole recirculation is slightly smaller. Looking at the value near the end of the channel instead both the Van Leer and the upwind show a lower value with respect to the CFL3D code. Comparing in Figure~\ref{fig:bfscomp} the profiles of the $u$ component of the velocity along some section downstream with respect to the step, we obtain in a similarly a good agreement between the Van Leer result and the one from the CFL3D code, while the result from the upwind method presents a small shift, in particular in the cases $x/H=4$ and $x/H=10$. Along the section at $x/H=1$ the velocity at the wall is positive for the Van Leer and the CFL3D, since we are in correspondence of the corner eddy. For the upwind method, instead, the velocity is negative, as we are already in the bigger eddy because the whole pattern is anticipated.
\begin{figure}[ht]
	\centering
	\subfloat[$x/H=-4$]{\input{../img/bfs_fin_vel0_report}}
	\subfloat[$x/H=1$]{\input{../img/bfs_fin_vel1_report}}\\
	\subfloat[$x/H=4$]{\input{../img/bfs_fin_vel2_report}}
	\subfloat[$x/H=10$]{\input{../img/bfs_fin_vel4_report}}
	\caption[Velocity profiles in the backward facing step test]{Profiles of the $u$ component of the velocity [$\si{m/s}$] along four sections in the backward facing step test. $Re_H=\num{3.6e4}$. $U_\text{ref}$ is the velocity in the centre of the channel at $x/H=-4$.}
	\label{fig:bfscomp}
\end{figure}
%The NASA LaRC CFD code CFL3D uses:
%\begin{itemize}
%	\item free-stream turbulence intensity = 0.061\%
%	\item free-stream turbulent viscosity (relative to laminar) = 0.009
%	\item in this case the simulations were \emph{quasi-steady}, i.e. the 
%	solution does not converge readily to a steady state result when a refined 
%	grid is used. However, when run-time accurately, the solution settles down 
%	and becomes reasonably steady (quasi-steady).
%	\item The code is for compressible flows at ``essentially incompressible" 
%	conditions of M=0.128. There may be a very small influence of 
%	compressibility.
%	\item non-dimensional CFD code
%	\item first order turbulence advection in the turbulence transport equations
%	\item Neglects two terms that are zero for incompressible flows
%	\item implicit time advancement (also second order)
%	\item Central differencing in Space? Non lo dice cosa usa, inoltre secondo 
%	me non usa una staggered grid.
%\end{itemize}
\section{Cavities problem}
In this section our goal is to study the behaviour of a coupled turbulent free-flow and 
porous-medium system, that are in contact by means of a rough interface, or that presents 
obstacles, exploiting the benefit of high-order methods. A first approximation of this kind of interface can be obtained with a series of little
cavities, as it is used in Subsection~\ref{subsec:roughchannel} to study the \emph{rough channel} with the 
Navier-Stokes equations. Now we want to use the RANS equations and as 
turbulence model we choose the $k\text{-}\omega$ that we tested in the previous section using the backward facing step case.
Since we use a structured grid and we need very small cells next to walls that have different orientations in order to resolve the viscous sub-layer, we decide to consider a simple configuration with only two cavities, in order not to increase too much the computational effort. We start our analysis from the free-flow, then we take into account the effect of a porous-medium.
%
\subsection{Cavities mutual influence}
In this first test we simulate only the free-flow solving the RANS equations  \eqref{eq:ransmass}-\eqref{eq:ransmom}-\eqref{eq:komegak}-\eqref{eq:komegaomega} in the domain $\Omega_\text{ff}$ depicted in Figure~\ref{fig:singledomain}. It consists of a channel with inflow boundary 
condition on the left boundary $\Gamma_\text{in}$:
\begin{equation}
	\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad u_\text{in} = \SI{1}{m/s},
\end{equation}
no-slip boundary conditions on the lower boundary $\Gamma_w$, symmetry boundary conditions on the upper boundary $\Gamma_\text{sym}$ and outflow boundary conditions on the right boundary $\Gamma_\text{out}$, fixing the value of the pressure:
\begin{equation}
	p = p_{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
The height of the channel is $\SI{0.6}{m}$ and it is chosen such that the flow is almost uniform in the upper part of the domain and we can exploit symmetry boundary conditions. The first portion of the lower wall is flat, in order to let the flow develop, then there are the two cavities of height $h=\SI{0.1}{m}$ and length $\SI{0.5}{m}$, spaced by a tunable distance $d$.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{cavities_domain.pdf}
%	\includegraphics[width=\textwidth]{cavities_domain_axis.pdf}
	\caption[Free-flow domain $\Omega_\text{ff}$ in the cavities problem]{Free-flow domain $\Omega_\text{ff}$ in the cavities problem. The distance $d$ is varied from $\SI{0.05}{m}$ to $\SI{2}{m}$. For convenience we set the origin of the $x$-axis at the $\Gamma_\text{in}$ and the origin of the $y$-axis at the bottom of the cavities.}
	\label{fig:singledomain}
\end{figure}
The density of the fluid is $\varrho = \SI{1}{kg/m^3}$ and the kinematic viscosity is $\nu=\SI{e-5}{m^2/s}$, so that the Reynolds number is $Re=\num{6e5}$. We neglect the gravity contribution.

We want to see how the flow field in the second cavity is affected by the 
presence of the first cavity, depending on the distance $d$ between them, that 
has been varied from $\SI{0.05}{m}$ to $\SI{2}{m}$.

We simulate the time interval $[0, T_\text{end}]$, with $T_\text{end}=\SI{30}{s}$, such that the solution reaches an equilibrium, and an initial time-step $\Delta t = \SI{e-5}{s}$. We start from the initial 
conditions of uniform parallel flow for $y>h$ and no flow for $y\leq h$
\begin{equation}
	\mathbf{v} = [u_\text{init},0]^\mathrm{T}, \quad u_\text{init} =
	\begin{cases}
	u_\text{in} \quad&\text{if $y>h$}\\
	0 \quad&\text{if $y\leq h$}
	\end{cases}
\end{equation}
while we set in the whole $\Omega_\text{ff}$ $p=p_\text{ext}$, $k=k_\text{in}$ and $\omega=\omega_\text{in}$, estimated with the formulas~\eqref{eq:koic}.

Performing a sensitivity analysis, we choose a grid made of $\num{377x50}$ 
elements, with gradings in the inlet and outlet portions of the channel in order 
to have small uniform cells around the two cavities, with sizes of $\SI{5x3.3}{mm}$.
%Aggiungere qualcosa sulla sensitivity analysis

At a first glance the behaviour of the fluid in the two cavities is very 
similar, there is not any strong influence of the first one on the second one 
and the pattern of the velocity field is the same, as we see in Figure~\ref{fig:veld1}. 
%aggiungere cenno a quali recirculations ci sono e mettere le freccette 
%nell'immagine?
\begin{figure}
	\centering
	\includegraphics[width=\textwidth%, trim={0 0 0 6cm}, clip
	]{cavities_dist1_vel_report.png}
	\caption[Magnitude of the velocity field in the cavities problem]{Magnitude of the velocity field [$\si{m/s}$] around the cavities, with $d=\SI{1}{m}$ at $t=T_\text{end}$. $Re=\num{6e5}$.}
	\label{fig:veld1}
\end{figure}
In order to better analyse the results of the simulations, we compare the 
profiles of the velocity in the first cells above $y=h$. The velocity in these points drives the flow in the cavities, 
since we start from zero velocity inside them. Looking at the profiles in Figure~\ref{fig:velprofile1}, there is a positive 
peak of the velocity near the centre of each cavity, then, when the wall starts 
again, there is a negative peak, followed by a space, that we call recovery 
distance $d_{rec}$, of approximately $\SI{0.5}{m}$, in which there is a recovery 
of the value that the velocity had before the cavity. The values in the second 
cavity are slightly lower than the correspondent ones in the first cavity, but 
the shape is the same and this confirms the fact that the behaviour of the flow 
in the two cavities is the analogous.
\begin{figure}
	\centering
	\input{../img/cavities_vel1_report}
	\caption[Profile of the $u$ component of the velocity at $y=h$ in the cavities problem]{Profile of the $u$ component of the velocity at $y=h$, with a distance $d=\SI{1}{m}$ between cavities, at $t=T_\text{end}$. $Re = \num{6e5}$.}
	\label{fig:velprofile1}
\end{figure}

The peaks above the cavities are due to the fact that those sections of the profile are not 
touching the wall, so the wall friction is not highly affecting the velocity as it is
in the other sections and this allows the velocity to reach higher values.
When a cavity is over and the wall begins there is a sudden decrease in the 
velocity because before the corner of the cavity the flow is split into a 
portion that goes down and generates the recirculation and another portion that 
instead goes up, as we observe in Figure~\ref{fig:vel_split}.
\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{cavities_vel_split_report.png}
	\caption[$v$-component of the velocity near end of a cavity in the cavities problem]{$v$-component of the velocity $\si{m/s}$ near end of a cavity. It can be observed that the flow splits. $Re = \num{6e5}$.}
	\label{fig:vel_split}
\end{figure}
This change in the flow direction implies a reduction of the $u$ component of the velocity. After the 
distance $d_{rec}$ the effect of the wall has restored the boundary layer that 
there was before the cavity. If $d < d_{rec}$, i.e. the distance between the 
cavities is smaller than the recovery distance, the flow in the second 
cavity will be slower because it will be driven by lower velocities.

We report in Figure~\ref{fig:velpeaks} the maximum values of the $u$-component 
of the velocity in correspondence of the peak above the second cavity, depending 
of the distance between the cavities.
\begin{figure}
	\centering
	\input{../img/cavities_peaks_report}
	\caption[Relation between the maximum velocity above the second cavity and 
	the distance between the cavities]{Relation between the maximum velocity in the peak above the second cavity and the distance $d$ between the cavities.}
	\label{fig:velpeaks}
\end{figure}
We see that if $d < d_{rec}$ the velocity is affected by the presence of 
the first cavity and so its value is lower. For $d>d_{rec}$ the velocity is 
slightly decreasing as $d$ increases; this fact is due to the turbulence that 
is generated near the end of the first cavity. As it can be seen in 
Figure~\ref{fig:kd1}, the turbulent kinetic energy that is generated from the 
first cavity is transported towards the second one, leading to an increased 
thickness of the boundary layer as we move in the $x$-direction.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth,% trim={0 0 0 7cm}, clip 
	]{cavities_dist1_k_report.png}
	\caption[Turbulen kinetic energy in the cavities problem]{Turbulent kinetic energy [$\si{m^2/s^2}$] around the cavities with $d=\SI{1}{m}$, at $t=T_\text{end}$. $Re=\num{6e5}$.}
	\label{fig:kd1}
\end{figure}
%
\subsection{Coupled problem}
%A more complex result.