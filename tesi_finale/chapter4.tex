\chapter{Numerical results} \label{chap:results}
In this chapter we present the numerical results.
At first, we perform some verifications of the methods developed for the Navier-Stokes equations.
The convergence of higher order methods is tested, first in space, 
then in time. After that, another spatial comparison test between the upwind 
method 
and the TVD methods is performed, using a channel flow. Eventually, the results 
from the backward facing step test using RANS equations are shown and 
compared to those from the CFL3D code from \cite{web:nasa}. 
%Afterwards, a turbulent flow through a channel with two small cavities is studied,
%.Finally, a turbulent flow through a channel with two small cavities is studied.
A second set of tests concerns the coupling with the porous-medium flow. First, we consider a turbulent flow through a channel with two cavities separated by a porous-medium and we study the influence of the permeability on the flow pattern. Then, we study a flow in a channel with a porous obstacle.
%Then, we modify the domain in order to have deeper cavities.
% At last, we consider a channel with a porous obstacle.
%
%and, at last, it is coupled
%with a porous-medium flow, analysing the changes for several values of permeability of the porous-medium.
%
\section{Navier-Stokes tests}
\subsection{Space convergence} \label{subsec:conv}
We want to test the spatial convergence order of the error of the 
solution of the Navier-Stokes equations computed in the $L^2(\Omega)$ norm:
\begin{equation}
	|\!|\phi_\text{ex} - \phi_h|\!|_{L^2(\Omega)} = \int_{\Omega} 
	(\phi_\text{ex} - 
	\phi_h)^2 \; dA,
\end{equation}
where $\phi$ can be the velocity of the pressure and $\phi_\text{ex}$ and 
$\phi_h$ 
are the corresponding exact and numerical solution.
We compare the results obtained with 
the upwind method \eqref{eq:upwind} and the TVD methods described in 
Subsection~\ref{subsec:tvd}.\\
We consider a steady version of the 
equations~\eqref{eq:nsmass}--\eqref{eq:nsmom}, neglecting the gravity term but taking into account two possible source terms $h$ and $\mathbf{f}$:
\begin{align}
	\label{eq:nssteadymass} \nabla \cdot \mathbf{v} -h = 0&\\
	\label{eq:nssteadymom} \nabla \cdot (\mathbf{v} \mathbf{v}^\mathrm{T}) - 
	\nabla \cdot (\nu \nabla \mathbf{v}) + \frac{1}{\varrho}\nabla p  
	-\mathbf{f} = \mathbf{0}&
\end{align}
For the sake of simplicity, we consider here 
all the quantities appearing in the equations to be non-dimensional.
%
\subsubsection{Sin-Cos test}
Let us solve the equations~\eqref{eq:nssteadymass}--\eqref{eq:nssteadymom} over 
a two-dimensional unit domain $\Omega=(0,1)^2$, with the following source terms:
\begin{align}
	h &= 0,\\
	\mathbf{f} &= [-2\nu \cos(x) \sin(y), \; 2\nu \cos(y) \sin(x)]^\mathrm{T},
\end{align}
so that, choosing $\varrho=1$, the analytical solution, depicted in 
Figure~\ref{fig:sincosexact}, is given by
\begin{align}
\label{eq:uexsin}	u_\text{ex}(x,y) &= -\cos(x)\sin(y),\\
	v_\text{ex}(x,y) &= \sin(x)\cos(y),\\
\label{eq:pexsin}	p_\text{ex}(x,y) &= -\frac{\cos(2x)+\sin(2y)}{4}.
\end{align}
Dirichlet boundary conditions for the velocity are applied on the whole 
boundary $\partial \Omega$ using the exact solution. Because of this choice, 
the pressure solution is defined up to a constant, since it does not appear in 
the boundary conditions and only its gradient is involved in the momentum 
equation \eqref{eq:nssteadymom}. Therefore, in order to match the particular 
exact solution \eqref{eq:pexsin}, we fix at one point in the domain the value 
of the numerical solution.
\begin{figure}
	\centering
	\subfloat{\includegraphics[width=0.5\textwidth]{sincos_exact_v_report.png}}
	\subfloat{\includegraphics[width=0.5\textwidth]{sincos_exact_p_report.png}}
	\caption[Exact solution of the Sin-Cos test]{Exact solution of the Sin-Cos 
	test \eqref{eq:uexsin}--\eqref{eq:pexsin}. On the left the magnitude of the 
	velocity field, on the right the 
	pressure field.}
	\label{fig:sincosexact}
\end{figure}

The problem is solved over a sequence of five uniform grids, starting from 
$\num{4x4}$ cells and each time halving their sizes. Both the cases of $\nu=1$ 
and $\nu=\num{e-3}$ are tested, that correspond respectively to $Re=1$ and 
$Re=\num{e3}$. In Figure~\ref{fig:sin_err}, the errors computed are reported 
depending on the square root of the number of cells, while in 
Table~\ref{tab:sin_conv} we can compare directly the 
order of convergence for different differencing schemes.
\begin{figure}
	\centering
	\subfloat[Upwind, $Re = 1$]{
		\input{../img/l2error_test_navierstokes_sincos}}
	\subfloat[Upwind, $Re = \num{e3}$]{
		\input{../img/l2error_test_navierstokes_sincos_hre}}\\
	\subfloat[Min-Mod, $Re = 1$]{
		\input{../img/l2error_test_navierstokes_sincos_mm}}
	\subfloat[Min-Mod, $Re = \num{e3}$]{
		\input{../img/l2error_test_navierstokes_sincos_mm_hre}}\\
	\subfloat[Van Leer, $Re = 1$]{
		\input{../img/l2error_test_navierstokes_sincos_vl}}
	\subfloat[Van Leer, $Re = \num{e3}$]{
		\input{../img/l2error_test_navierstokes_sincos_vl_hre}\label{fig:sin_err_vl_hre}}
	\caption[$L^2(\Omega)$ norm of the errors for the Sin-Cos 
	test]{$L^2(\Omega)$ norm of the errors 
	for the Sin-Cos 
	test depending on the square root of the number of cells in the grid. 
	The grey lines are the reference lines parallel to a first order convergence (the lower one) and a
	second order convergence (the upper one).}
	\label{fig:sin_err}
\end{figure}

\begin{table}
	\centering
	\subfloat[][$Re=1$]{
	$\begin{array}{c|ccc}
	\toprule
	& \text{Upwind} & \text{Min-Mod} & \text{Van Leer} \\ 
	\midrule
	p & 1.008 & 1.569 & 1.626\\
	u & 1.143 & 1.962 & 1.977\\
	v & 1.058 & 1.928 & 1.945\\
	\bottomrule
	\end{array}
	\label{tab:sin_lre}$
	}\\
	\subfloat[][$Re=\num{e3}$]{
	$\begin{array}{c|ccc}
	\toprule
	& \text{Upwind} & \text{Min-Mod} & \text{Van Leer} \\ 
	\midrule
	p & 1.148 & 1.659 & 1.058\\
	u & 1.071 & 1.441 & 1.437\\
	v & 1.068 & 1.533 & 1.560\\
	\bottomrule
	\end{array}
	\label{tab:sin_hre}$
	}
	\caption[Convergence orders for the Sin-Cos test]{Convergence orders for 
	the Sin-Cos test. They are computed considering the last two refinements of 
	the grid.}
	\label{tab:sin_conv}
\end{table}

We observe, as expected, a better behaviour of the TVD methods with respect to 
the upwind method. In Table~\ref{tab:sin_lre}, we can see that, at $Re=1$, the 
formers show a full second order convergence for the velocity, while for the pressure the
rate is a bit lower; the latter, instead, shows a first order convergence for 
all variables. At 
$Re=\num{e3}$, a slight decrease of the rates of the TVD methods occurs also 
for 
the velocities, but they remain higher then the ones of the upwind method. In 
Table~\ref{tab:sin_hre}, we observe a convergence order of 1 for the pressure 
using the Van Leer flux limiter, but, looking at 
Figure~\ref{fig:sin_err_vl_hre}, we can 
see that the global trend points to a convergence of higher order. Moreover, it 
can be observed how, thanks to the faster convergence, on the same grid the 
absolute values of the errors reach smaller values using the TVD methods. 
Between the Min-Mod and Van Leer flux limiters it is hard to say which one 
performs better. The results are very similar.

Analogous tests with other analytical solutions are reported in 
Appendix~\ref{app:conv}. They show always a better convergence of the TVD 
methods with respect to the upwind method, but in some cases the convergence 
order of pressure and velocity behave differently.
%
\subsection{Time convergence}
We test the time convergence of the $L^\infty(0,T;L^2(\Omega))$ norm of the 
error of the solution of the Navier-Stokes equations:
\begin{equation}
	|\!|\phi_\text{ex}-\phi_h|\!|_{L^\infty(0,T;L^2(\Omega))} = \esssup_{t \in 
	(0,T)} |\!|\phi_\text{ex}(t) - \phi_h(t) |\!|_{L^2(\Omega)}, 
\end{equation}
where $\esssup$ denotes the \emph{essential supremum}, that for a function 
$f:\Omega\rightarrow\mathbb{R}$ is defined as
\begin{equation}
	\esssup_\Omega f = \inf \{\text{$M \in \mathbb{R}$ : $ |f(x)| \leq 
	M$ a.e. in $\Omega$} \}.
\end{equation}
In our case it will be the maximum of the $L^2(\Omega)$ norm of error over the 
time interval $(0,T)$. We compare the results 
obtained with the BE method \eqref{eq:be} and the BDF2 method \eqref{eq:bdf2}.\\
We consider the unsteady version of the 
equations~\eqref{eq:nssteadymass}--\eqref{eq:nssteadymom}:
\begin{align}
	\label{eq:nsunsteadymass} \nabla \cdot \mathbf{v} -h = 0&\\
	\label{eq:nsunsteadymom} \frac{\partial \mathbf{v}}{\partial t} +\nabla 
	\cdot (\mathbf{v} \mathbf{v}^\mathrm{T}) - 
	\nabla \cdot (\nu \nabla \mathbf{v}) + \frac{1}{\varrho}\nabla p  
	-\mathbf{f} = \mathbf{0}&
\end{align}
Again the gravity is neglected and two possible sources $h$ and $\mathbf{f}$ 
are taken into account, moreover all the quantities are considered to be 
non-dimensional.
%
\subsubsection{Unsteady Sin-Cos test}
Let us solve the equations~\eqref{eq:nsunsteadymass}--\eqref{eq:nsunsteadymom} 
over a two dimensional unit domain $\Omega=(0,1)^2$ and in the time interval 
$(0,T)$, with $T=1$. We use the following source terms:
\begin{align}
h &= 0,\\
\mathbf{f} &= 2\Big(\frac{\cos(2t)}{\varrho} + \nu \sin(2t)\Big)[- \cos(x) 
\sin(y), \; 
\cos(y) \sin(x)]^\mathrm{T},
\end{align}
so that, choosing $\varrho=1$, the analytical solution is given by
\begin{align}
\label{eq:uexunssin}	u_\text{ex}(x,y) &= -\cos(x)\sin(y)\sin(2t),\\
v_\text{ex}(x,y) &= \sin(x)\cos(y)\sin(2t),\\
\label{eq:pexunssin}	p_\text{ex}(x,y) &= 
-\frac{\cos(2x)+\sin(2y)}{4}\sin^2(2t).
\end{align}
It is equal to \eqref{eq:uexsin}--\eqref{eq:pexsin}, used in the steady test 
for the space convergence, except for the modulation over time. We choose 
$\nu=0.1$, so that $Re=10$. Dirichlet boundary conditions for the velocity are 
applied on the whole boundary $\partial \Omega$ using the exact solution. 
The pressure is again fixed  at one point in order to match the particular exact solution 
\eqref{eq:pexunssin}.

The problem is solved seven times subdividing the time interval $(0,T)$ into 
uniform time-steps and each time doubling their number, starting from a 
discretization with a
single time-step. Uniform grids of $\num{40x40}$ and $\num{80x80}$ cells are 
employed and, as a differencing scheme, the TVD method with the Van Leer flux 
limiter \eqref{eq:vl} is used. From Figure~\ref{fig:timeerr}, we observe that, 
as expected, the BE method shows a first order convergence, while the BDF2 
method is of second order. Moreover we notice that, with a grid of 
$\num{40x40}$ cells, in the last refinement the error with the BDF2 method does 
not decrease anymore. This happens because the grid is too coarse and the 
spatial error becomes dominant over the temporal one, so that, even with small 
time-steps, we can not improve the solution.
Refining the grid, the spatial error is reduced and the temporal order of convergence is restored entirely for the pressure and almost for the velocity.
\begin{figure}
	\centering
	\subfloat{\input{../img/time_convergence_p_report}}
	\subfloat{\input{../img/time_convergence_v_report}}
	\caption[$L^\infty(0,T;L^2(\Omega))$ norm of the errors for the unsteady 
	Sin-Cos 
	test]{$L^\infty(0,T;L^2(\Omega))$ norm of the errors for the unsteady 
	Sin-Cos test 
	depending on the number of time-steps. On the left the errors for the 
	pressure, on the right the errors for the magnitude of the velocity. The grey lines are the reference lines parallel to a first order convergence (the lower one) and a
	second order convergence (the upper one).}
	\label{fig:timeerr}
\end{figure}
%
\subsection{Rough channel test} \label{subsec:roughchannel}
We test the behaviour of the TVD methods compared to the upwind method solving 
the unsteady Navier-Stokes equations \eqref{eq:nsmass}--\eqref{eq:nsmom} in 
a two-dimensional channel with a \emph{rough} (i.e. non-flat) lower boundary that 
consists of small, evenly spaced cavities. Two different 
configurations are studied, one with shallow cavities, depicted in 
Figure~\ref{fig:roughdom}, and another with deeper cavities, depicted in 
Figure~\ref{fig:roughdomdeep}.

On the left boundary $\Gamma_\text{in}$ we set inflow boundary conditions 
\eqref{eq:inflow}, specifying a horizontal velocity
\begin{equation}
	\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad 
	u_\text{in} = \SI{1}{m/s}.
\end{equation}
On the lower and upper boundaries $\Gamma_w$, we set no-slip boundary 
conditions 
\eqref{eq:noslip}, while on the right boundary $\Gamma_\text{out}$ we set 
outflow boundary conditions \eqref{eq:outflow}, fixing the value of the pressure
\begin{equation}
	p = p_\text{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
As initial conditions, velocity is set to zero everywhere, while pressure is 
set to $p_\text{ext}$ everywhere. Density is 
$\varrho=\SI{1}{kg/m^3}$. The gravity contribution in \eqref{eq:nsmom} is 
neglected.
%
\subsubsection{Shallow cavities}
In the case of shallow cavities we use the domain in Figure~\ref{fig:roughdom} 
and we employ a uniform grid of $\num{95x50}$ cells. The problem is then solved 
over the time interval ($0,T$), with $T=\SI{10}{s}$. The initial time-step is 
$\Delta t=\SI{5e-3}{s}$, then it is adapted as explained in 
Section~\ref{sec:algeq}, allowing a maximum time-step of $\SI{0.1}{s}$. 
At first we set $\nu=\SI{5e-4}{m^2/s}$, so that $Re=\num{2e3}$. Since we do not 
have an analytical solution for this problem, we compute a \emph{reference 
solution} using the upwind method over a grid six times finer (see Figure~\ref{fig:roughchannelgrid}).

In Figure~\ref{fig:linecompshallow} we compare the profiles of the magnitude 
of the velocity along a cross-section near the end of the channel, at 
$x=\SI{8.75}{m}$, i.e. at the middle of the last cavity.  The TVD solutions 
match the reference case, while the upwind solution shows a small shift, 
especially in the lower part of the channel, above the cavity. In 
Table~\ref{tab:errshallow}, we can see the 
$L^2(\Omega)$ norm 
of the errors of the coarse solutions computed with respect to the reference 
one, along the cross-section mentioned above. The one related to the 
upwind method is at least one order of magnitude larger than the others. 
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_domain2.pdf}
	\caption[Domain of the rough channel test with shallow cavities]{Domain of 
	the rough channel test with shallow cavities.}
	\label{fig:roughdom}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_channel_vl_report.png}
	\caption[Magnitude of the velocity in the rough channel test with 
	shallow cavities]{Magnitude of the velocity $[\si{m/s}]$ in the 
	rough channel test with shallow cavities at $t=T$. $Re=\num{2e3}$. 
	Van Leer flux limiter.}
	\label{fig:roughchannelvl}
\end{figure}
% Nuova figura:
\begin{figure}
	\centering
	\includegraphics[width=\textwidth, trim={0 0 0 1.5cm}, clip]{rough_channel_one_step_arrows.png}
	\caption[Magnitude of the velocity in the rough channel test with schallo cavities around the last cavity]{Magnitude of the velocity $[\si{m/s}]$ in the rough channel test with shallow cavities, around the last cavity, at $t=T$, in the reference case. $Re=\num{2e3}$. The arrows are not scaled.}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_channel_grid.pdf}
	\caption[Grid comparison in the rough channel test]{Comparison of the grids used in the rough channel test. In black the grid used for the reference solution, with cell sizes $\SI{16.7x3.3}{mm}$, in blue the grid used in the other simulations, with cell sizes $\SI{100x20}{mm}$.}
	\label{fig:roughchannelgrid}
\end{figure}
\begin{figure}
	\centering
	\input{../img/line_comparison}
	\caption[Profile of the magnitude of the velocity in the rough channel with 
	shallow cavities at $Re=\num{2e3}$]{Profile of the magnitude of the 
	velocity $[\si{m/s}]$ in the rough channel with shallow cavities along the 
	cross-section $x=\SI{8.75}{m}$, at $t=T$. $Re=\num{2e3}$. The region on 
	the left of the dashed line is inside the cavity.}
	\label{fig:linecompshallow}
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{ccc}
	\toprule
	\text{Upwind} & \text{Van Leer} & \text{Van Alabada} \\
	\midrule
	\num{1.708e-4} & \num{9.556e-6} & \num{1.119e-5} \\
	\midrule
	\text{Min-Mod} & \text{Superbee} & \text{MC Limiter} \\
	\midrule
	\num{1.537e-5} &  \SI{8.335e-6} & \num{8.659e-6}\\
	\bottomrule
	\end{array}
	\]
	\caption[$L^2(\Omega)$ norm of the errors for the profile of the magnitude 
	of the 
	velocity in 
	the rough channel with shallow cavities at 
	$Re=\num{2e3}$]{$L^2(\Omega)$ norm of the errors for 
	the profile of the magnitude of the velocity along the cross-section at 
	$x=\SI{8.75}{m}$ and $t=T$ in the rough channel with shallow 
	cavities. $Re = \num{2e3}$.}
	\label{tab:errshallow}
\end{table}

We repeat the test choosing $\nu=\SI{1}{m^2/s}$, so that $Re=1$. In 
Figure~\ref{fig:linecompshallowlre} we see that all the solutions have the same 
profile, moreover in the cavity there is not any recirculation. In 
Table~\ref{tab:errshallow_lre} the $L^2(\Omega)$ norm of the errors are 
reported; the 
upwind one is 
the bigger, but they are all very similar. So, in this situation of low $Re$, 
being the results very similar, the benefit of using a high-resolution scheme 
is reduced.
\begin{figure}
	\centering
	\input{../img/line_comparison_lre}
	\caption[Profile of the magnitude of the velocity in the rough channel with 
	shallow cavities at $Re=1$]{Profile of the magnitude of the velocity 
	$[\si{m/s}]$ in the rough channel with shallow cavities along the 
	cross-section 
	$x=\SI{8.75}{m}$, at $t=T$. $Re=1$. The region on the left of the 
	dashed line is inside the cavity.}
	\label{fig:linecompshallowlre}
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{ccc}
	\toprule
	\text{Upwind} & \text{Van Leer} & \text{Van Alabada}\\
	\midrule
	\num{3.431e-6} & \num{2.917e-6} & \num{2.937e-6}\\
	\midrule
	\text{Min-Mod} & \text{Superbee} & \text{MC Limiter} \\ 
	\midrule
	\num{2.956e-6} & \num{2.899e-6} & \num{2.902e-6}\\
	\bottomrule
	\end{array}
	\]
	\caption[$L^2(\Omega)$ norm of the errors for the profile of the magnitude 
	of the 
	velocity in 
	the rough channel with shallow cavities at $Re=1$]{$L^2(\Omega)$ norm of 
	the errors for 
	the 
	profile of the magnitude of the velocity along the cross-section at 
	$x=\SI{8.75}{m}$ and $t=T$ in the rough channel with shallow 
	cavities. $Re = 1$.}
	\label{tab:errshallow_lre}
\end{table}
%
\subsubsection{Deep cavities}
In the case of deep cavities we use the domain in Figure~\ref{fig:roughdomdeep} 
and we employ a uniform grid of $\num{95x70}$ cells. Again we solve until 
$T=\SI{10}{s}$, starting from an initial time-step of $\SI{e-3}{s}$. We set 
$\nu=\SI{5e-4}{m^2/s}$, so that $Re=\num{2.8e3}$. As before we compute a 
reference solution over a grid six times finer.

In Figure~\ref{fig:linecompdeep} we compare the profiles of the magnitude of 
the velocity along the cross-section at $x=\SI{8.75}{m}$. Now the biggest 
differences 
are in the region inside the cavity, where a recirculation occurs. The upwind 
method, with its numerical diffusion, smooths the profile, while the TVD 
methods produce more accurate results, even if they do not match exactly the 
reference solution.
Further, when looking at the $L^2(\Omega)$ norm of the absolute errors reported in 
Table~\ref{tab:errdeep}, we see that the upwind method has again the largest error, 
but the difference with the other schemes is reduced with respect to the 
previous case of shallow cavities. This is due to the wider recirculation region with respect to the previous case, which is critical for the accuracy of all the methods because it shows local extrema for the velocity.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{rough_domain_highstep2.pdf}
	\caption[Domain of the rough channel test with deep cavities]{Domain of the 
	rough channel test with deep cavities.}
	\label{fig:roughdomdeep}
\end{figure}
\begin{figure}
	\centering
	\input{../img/line_comparison_highstep_report}
	\caption[Profile of the magnitude of the velocity in the rough channel with 
	deep cavities at $Re=\num{2.8e3}$]{Profile of the magnitude of the velocity 
		$[\si{m/s}]$ in the rough channel with deep cavities along the 
		cross-section 
		$x=\SI{8.75}{m}$, at $t=T$. $Re=\num{2.8e3}$. The region on 
		the 
		left of the dashed line is inside the cavity.}
	\label{fig:linecompdeep}
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{ccc}
	\toprule
	\text{Upwind} & \text{Van Leer} & \text{Van Alabada}\\
	\midrule
	\num{3.180e-4} & \num{5.862e-5} & \num{6.900e-5}\\
	\midrule
	\text{Min-Mod} & \text{Superbee} & \text{MC Limiter} \\
	\midrule
	\num{8.579e-5} & \num{7.883e-5} & \num{5.584e-5}\\
	\bottomrule
	\end{array}
	\]
	\caption[$L^2(\Omega)$ norm of the errors for the profile of the magnitude 
	of the 
	velocity in 
	the rough channel with deep cavities]{$L^2(\Omega)$ norm of the errors for 
	the profile 
	of the 
	magnitude of the velocity along the cross-section at $x=\SI{8.75}{m}$ and 
	$t=T$ in the rough channel with deep cavities. $Re = \num{2.8e3}$.}
	\label{tab:errdeep}
\end{table}
%
\section{RANS test: backward facing step} \label{sec:bfs}
The backward facing step is a widely-used test configuration, in which a 
turbulent flow in a channel incurs separation because of a sudden enlargement 
in the flow domain. We can see that in Figure~\ref{fig:bfsarrows} there are a 
big recirculation after the step, a smaller eddy near the corner and a very 
small 
eddy precisely at the corner. We want to use this problem in order to test the 
results that we obtain using the TVD method, with the Van Leer flux limiter 
\eqref{eq:vl}, and the $k\text{-}\omega$ turbulence model, comparing them with 
the numerical results from \cite{web:nasa}, computed using the NASA CFL3D code, 
and the experimental results from \cite{bfs:driver}.

In the domain $\Omega$, depicted in Figure~\ref{fig:bfsdomain}, with a step height $H=\SI{1}{m}$, we solve the RANS equations \eqref{eq:ransmass}-\eqref{eq:ransmom}-\eqref{eq:komegak}-\eqref{eq:komegaomega}, imposing inflow boundary conditions on the left boundary $\Gamma_\text{in}$
\begin{equation}
	\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad u_\text{in} = \SI{44.2}{m/s},
\end{equation} no-slip boundary conditions on the lower and upper boundaries $\Gamma_w$ and outflow boundary conditions on the right boundary $\Gamma_\text{out}$, fixing the value of pressure
\begin{equation}
	p = p_\text{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{bfs_domain_axis.pdf}
	\caption[Domain of the backward facing step test]{Domain $\Omega$ of the backward facing step test. For convenience, we set the origin of the $x$-axis in correspondence of the step and the origin of the $y$-axis at the bottom of the channel.}
	\label{fig:bfsdomain}
\end{figure}
The density is $\varrho = \SI{1}{kg/m^3}$ and the viscosity is $\nu=\SI{1.228e-3}{m^2/s}$, so that, in order to match \cite{web:nasa}, the Reynolds number based on the step height results
\begin{equation}
	Re_H = \frac{u_\text{in}H}{\nu} \simeq \num{3.6e4}.
\end{equation}

The domain sizes are chosen according to \cite{web:nasa}, with the only 
exception of the channel length before the step. In fact, in \cite{web:nasa}, a 
small portion of the horizontal boundary near $\Gamma_\text{in}$ uses symmetry 
boundary conditions, but we simplify the model employing no-slip boundary 
conditions on the whole horizontal boundaries. As a consequence, we shorten the 
channel length in order to match the profile of the $u$ 
component of the velocity along the cross-section at the position $x/H=-4$ as closely as possible, 
with a boundary layer thickness of approximately $1.5H$ (see 
Figure~\ref{fig:bfscomp}).

According to \cite{web:nasa}, CFL3D is a code for compressible fluids, but it was used at ``essentially incompressible'' conditions, such that the influence of compressibility should be very small. Moreover it is reported that, running unsteady simulations, the solution settles down and becomes reasonably steady (quasi-steady); in \cite{bfs:cfl3d} it is explained that a second order implicit method for the advancement in time is used.

Thus, we employ the BDF2 method for non-constant time-steps \eqref{eq:bdf2gen}, starting from $\Delta t = \SI{e-5}{s}$ and simulating until $T = \SI{30}{s}$. It can be observed that, after approximately $t=\SI{20}{s}$, the solution stabilizes at a steady state. As initial conditions we set
\begin{equation}
p=p_\text{ext} \quad \forall \mathbf{x} \in \Omega, \quad \mathbf{v} = [u_\text{init},0]^\mathrm{T} \quad u_\text{init} = \begin{cases}
u_\text{in} \quad&\text{if $x\leq 0$}\\
\frac{8}{9}u_\text{in} \quad&\text{if $x>0$}
\end{cases}
\end{equation}
The factor $8/9$ ensures that the flow rate at $\Gamma_\text{in}$ and at $\Gamma_\text{out}$ is the same. For $k$ and $\omega$ we set in the whole domain the values estimated with \eqref{eq:koic}.

According to \cite{web:nasa}, a key indicator for the reliability of a 
simulation is the prediction of the \emph{reattachment length} $l_\text{rea}$, 
i.e. the distance after the step at which the recirculation finishes and thus 
the $u$ component of the velocity at the bottom of the channel becomes 
positive. We analyse this length computing the \emph{friction coefficient} 
$C_f$, that is a non-dimensional form of the stress at the wall, which is 
defined by:
\begin{equation}
C_f = \frac{\tau_w}{\frac{1}{2}\varrho U_\text{ref}^2}, \quad \tau_w = \mu \frac{\partial u}{\partial y} \Big|_{y=0}.
\end{equation}
$U_\text{ref}$ is the $u$ component of the velocity at the centre of the channel at $x/H=-4$. In our case when $C_f<0$ the flow is recirculating, then, at $x=l_{rea}$, $C_f$ becomes positive. The numerical results from \cite{web:nasa} predict $l_\text{rea}/H \simeq 6.8$, while the experimental results from \cite{bfs:driver} predict $l_\text{rea}/H = 6.26 \pm 0.10$, as it can be seen in Figure~\ref{fig:bfscf}.

Performing a sensitivity analysis in order to choose a suitable grid, we observe that:
\begin{itemize}
	\item with a coarse mesh the reattachment length decreases, in particular a refinement of the smallest cell in the $y$-direction is effective.
	\item too stretched cells increase the number of Newton iteration needed to get the convergence of the problem.
	\item the cells in the portion of the channel after the step can be coarsened in the $x$-direction without a great influence on the solution.
	\item too refined cells in the $y$-direction in the area with the 
	recirculation do not improve the solution in a relevant way.
\end{itemize}
So, in the following analysis, we choose a grid made of $\num{119x70}$ cells, employing gradings up to 1.25 in order to have small cells near the walls, as it is required by the $k\text{-}\omega$ model. In Figure~\ref{fig:bfsgrid} we can see the grid in the region around the step.

\begin{figure} %mettere in paraview frecce 2d
	\centering
	\includegraphics[width=\textwidth]{bfs_glimphs2.png}
	\caption[Velocity field after the backward facing step]{Velocity field $[\si{m/s}]$ after the backward facing step at $t=T$. $Re_H=\num{3.6e4}$. The arrows are not scaled.}
	\label{fig:bfsarrows}
\end{figure}
%nuova immagine:
\begin{figure}
	\centering
	\includegraphics[width=0.8\textwidth]{bfs_grid.png}
	\caption[Velocity field and grid around the backward facing step]{Velocity field $[\si{m/s}]$ and grid around the backward facing step at $t=T$. $Re_H=\num{3.6e4}$. The arrows are not scaled.}
	\label{fig:bfsgrid}
\end{figure}
\begin{figure}[t]
	\centering
	\input{../img/bfs_fin_cf_report}
	\caption[Friction coefficient in the backward facing step test]{Friction coefficient at the bottom of the channel after the backward facing step at $t=T$. The reattachment length is the distance at which it becomes positive after its global minimum.}
	\label{fig:bfscf}
\end{figure}

Regarding the reattachment length, we obtain a good agreement with the 
CFL3D code; looking at Figure~\ref{fig:bfscf}, with the Van Leer flux 
limiter we predict $l_\text{rea} /H \simeq 6.67$. Moreover, in the whole 
recirculating region, the two patterns are very similar, also compared to the 
experimental data from \cite{bfs:driver}. Using the first order upwind method, 
instead, we compute $l_\text{rea} /H \simeq 6.02$, so approximately a 10\% 
underestimation occurs. From the profile, it seems that the whole recirculation 
is slightly smaller. Looking at the value near the end of the channel, instead, 
both the Van Leer and the upwind show a lower value with respect to the CFL3D 
code. Comparing in Figure~\ref{fig:bfscomp} the profiles of the $u$ component 
of the velocity along some cross-sections downstream with respect to the step, 
we obtain, similarly, a good agreement between the Van Leer results and those 
from the CFL3D code, while the results from the upwind method present a small 
shift, in particular in the cases $x/H=4$ and $x/H=10$. Along the cross-section 
at $x/H=1$, the velocity at the wall is positive for the Van Leer and the 
CFL3D, since we are in correspondence of the corner eddy. For the upwind 
method, instead, the velocity is negative, as we are already in the bigger eddy 
because the whole pattern is shifted.
\begin{figure}
	\centering
	\subfloat[$x/H=-4$]{\input{../img/bfs_fin_vel0_report}}
	\subfloat[$x/H=1$]{\input{../img/bfs_fin_vel1_report}}\\
	\subfloat[$x/H=4$]{\input{../img/bfs_fin_vel2_report}}
	\subfloat[$x/H=10$]{\input{../img/bfs_fin_vel4_report}}
	\caption[Velocity profiles in the backward facing step test]{Profiles of 
	the $u$ component of the velocity [$\si{m/s}$] along four cross-sections in 
	the backward facing step test at $t=T$. $Re_H=\num{3.6e4}$. $U_\text{ref}$ 
	is the velocity in the centre of the channel at $x/H=-4$.}
	\label{fig:bfscomp}
\end{figure}
%The NASA LaRC CFD code CFL3D uses:
%\begin{itemize}
%	\item free-stream turbulence intensity = 0.061\%
%	\item free-stream turbulent viscosity (relative to laminar) = 0.009
%	\item in this case the simulations were \emph{quasi-steady}, i.e. the 
%	solution does not converge readily to a steady state result when a refined 
%	grid is used. However, when run-time accurately, the solution settles down 
%	and becomes reasonably steady (quasi-steady).
%	\item The code is for compressible flows at ``essentially incompressible" 
%	conditions of M=0.128. There may be a very small influence of 
%	compressibility.
%	\item non-dimensional CFD code
%	\item first order turbulence advection in the turbulence transport equations
%	\item Neglects two terms that are zero for incompressible flows
%	\item implicit time advancement (also second order)
%	\item Central differencing in Space? Non lo dice cosa usa, inoltre secondo 
%	me non usa una staggered grid.
%\end{itemize}
\FloatBarrier
\section{Free-flow and porous-medium flow coupling}
\subsection{Cavities problem}
In this subsection our goal is to study the behaviour of a coupled system with turbulent free-flow and 
porous-medium flow, that are in contact by means of a rough interface, exploiting the benefit of high resolution methods. A first approximation of this kind of interface can be obtained with a series of little
cavities, as it is used in Subsection~\ref{subsec:roughchannel} to study the \emph{rough channel} with the 
Navier-Stokes equations. Now we use the RANS equations with the 
$k\text{-}\omega$ that we tested in the previous section using the backward 
facing step case.
%
In order to resolve the viscous sub-layer, we need very small cells next to the walls, that in this case are not flat but have different orientations. Since we are using a structured grid, the flexibility of employing local refinements in order not to increase the computational effort too much is limited, thus we decide to consider a simple configuration with only two cavities.
%Since we use a structured grid and we need very small cells next to walls that 
%have different orientations in order to resolve the viscous sub-layer, we 
%decide to consider a simple configuration with only two cavities, in order not 
%to increase the computational effort too much.

We start our analysis from the free-flow, studying the pattern of the velocity 
field and, in particular, how, without the porous-medium, the two cavities 
influence each other.
After choosing a configuration such that this influence is minimized, we take 
into account the effect of a porous-medium, to see how its presence affects the 
whole flow field,. We consider both the cases of shallow cavities and deep cavities.
%
\subsubsection{Cavities mutual influence}
In this first test we simulate only the free-flow, solving the RANS equations  \eqref{eq:ransmass}-\eqref{eq:ransmom}-\eqref{eq:komegak}-\eqref{eq:komegaomega} in the domain $\Omega_\text{ff}$ depicted in Figure~\ref{fig:singledomain}. It consists of a channel with inflow boundary 
conditions on the left boundary $\Gamma_\text{in}$:
\begin{equation}
	\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad u_\text{in} = \SI{1}{m/s},
\end{equation}
no-slip boundary conditions on the lower boundary $\Gamma_w$, symmetry boundary conditions on the upper boundary $\Gamma_\text{sym}$ and outflow boundary conditions on the right boundary $\Gamma_\text{out}$, fixing the value of the pressure:
\begin{equation}
	p = p_\text{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
The height of the channel is $\SI{0.6}{m}$ and it is chosen such that the flow is almost uniform in the upper part of the domain so that we can exploit the symmetry boundary conditions. The first portion of the lower wall is flat, in order to let the flow develop, then there are the two shallow cavities of height $h=\SI{0.1}{m}$ and length $\SI{0.5}{m}$, spaced by a tunable distance $d$.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth]{cavities_domain_axis.pdf}
	\caption[Free-flow domain $\Omega_\text{ff}$ in the cavities problem]{Free-flow domain $\Omega_\text{ff}$ in the cavities problem. The distance $d$ is varied from $\SI{0.05}{m}$ to $\SI{2}{m}$. For convenience we set the origin of the $x$-axis at $\Gamma_\text{in}$ and the origin of the $y$-axis at the bottom of the cavities.}
	\label{fig:singledomain}
\end{figure}

We want to see how the flow field in the second cavity is affected by the 
presence of the first cavity, depending on the distance $d$ between them, that 
is varied from $\SI{0.05}{m}$ to $\SI{2}{m}$.

The density of the fluid is $\varrho = \SI{1}{kg/m^3}$ and its kinematic 
viscosity is $\nu=\SI{e-5}{m^2/s}$, so that the Reynolds number is 
$Re=\num{6e5}$. We neglect the gravity contribution.
We simulate the time interval $(0, T)$, with $T=\SI{30}{s}$, such that the solution reaches an equilibrium, and we use an initial time-step $\Delta t = \SI{e-3}{s}$. We start from the initial 
conditions of uniform parallel flow for $y>h$ and no flow for $y\leq h$
\begin{equation}
	\mathbf{v} = [u_\text{init},0]^\mathrm{T}, \quad u_\text{init} =
	\begin{cases}
	u_\text{in} \quad&\text{if $y>h$}\\
	0 \quad&\text{if $y\leq h$}
	\end{cases}
\end{equation}
while we set in the whole domain $\Omega_\text{ff}$ $p=p_\text{ext}$, $k=k_\text{in}$ and $\omega=\omega_\text{in}$, estimated with the formulas~\eqref{eq:koic}.

Performing a sensitivity analysis, we choose a grid made of $\num{377x50}$ cells for the case of $d=\SI{1}{m}$. It is important to have small uniform cells in the region of the cavities, so we employ gradings of 1.1 in the $x$-direction in the inlet and outlet portions of the channel, where we can afford to have longer cells. In the $y$-direction we employ instead a grading of 1.2 in the region above the cavities. As a result, the cell size around the two cavities is $\SI{5x3.3}{mm}$. When $d<\SI{1}{m}$ also the cells between the cavities are uniform, while when $d\geq \SI{1}{m}$ a slight symmetric grading of 1.025 is employed.

At a first glance, the behaviour of the fluid in the two cavities is very 
similar, there is not any strong influence of the first one on the second one 
and the pattern of the velocity field is the same, as we see in Figure~\ref{fig:veld1}. 
%aggiungere cenno a quali recirculations ci sono e mettere le freccette 
%nell'immagine?
\begin{figure}
	\centering
	\includegraphics[width=\textwidth%, trim={0 0 0 6cm}, clip
	]{cavities_dist1_vel_report.png}
	\caption[Magnitude of the velocity field in the cavities problem]{Magnitude of the velocity field [$\si{m/s}$] around the cavities, with $d=\SI{1}{m}$ at $t=T$. $Re=\num{6e5}$.}
	\label{fig:veld1}
\end{figure}
In order to better analyse the results of the simulations, we compare the 
profiles of the $u$ component of the velocity in the first cells above $y=h$. The velocity in these points drives the flow in the cavities, 
since we start from zero velocity inside them.
Looking at the profiles in Figure~\ref{fig:velprofile1}, there is a positive 
peak of the velocity near the centre of each cavity, then, when the wall starts 
again, there is a negative peak, followed by a
length of approximately $\SI{0.5}{m}$, hereby referred to as the recovery distance $d_{rec}$.
In this distance, the flow returns nearly to the dynamics before the cavity, so that the velocity recovers the value that had there.
The values in the second 
cavity are slightly lower than the corresponding ones in the first cavity, but 
the shape is the same. This confirms the fact that the behaviour of the flow 
in the two cavities is analogous.
\begin{figure}
	\centering
	\input{../img/cavities_vel1_report}
	\caption[Profile of the $u$ component of the velocity at $y=h$ in the cavities problem]{Profile of the $u$ component of the velocity at $y=h$, with a distance $d=\SI{1}{m}$ between cavities, at $t=T$. $Re = \num{6e5}$.}
	\label{fig:velprofile1}
\end{figure}

The peaks above the cavities are due to the fact that those sections of the 
profile are not touching the wall, so the wall friction is not highly affecting 
the velocity as it is in the other sections and this allows the velocity to 
reach higher values. When a cavity is over and the wall begins, there is a 
sudden 
decrease in the velocity because, before the corner of the cavity, the flow is 
split into a portion that goes down and generates the recirculation and another 
portion that instead goes up, as we observed in Figure~\ref{fig:vel_split}.
\begin{figure}
	\centering
	\includegraphics[width=0.7\textwidth]{cavities_vel_split_report.png}
	\caption[$v$ component of the velocity near end of a cavity in the cavities 
	problem]{$v$ component of the velocity $[\si{m/s}]$ near end of a cavity at 
	$t=T$. It can be observed that the flow splits. $Re = \num{6e5}$.}
	\label{fig:vel_split}
\end{figure}
It is likely that this change in the flow direction implies a reduction in the 
$u$ component of the velocity. After the 
distance $d_{rec}$, the effect of the wall has restored the boundary layer that 
there was before the cavity. If the distance between the 
cavities is smaller than the recovery distance, i.e. $d < d_{rec}$, the flow in 
the second cavity will be slower because it will be driven by lower velocities.

We report in Figure~\ref{fig:velpeaks} the maximum values of the $u$ component 
of the velocity in correspondence of the peak above the second cavity, 
depending on the distance between the cavities.
\begin{figure}
	\centering
	\input{../img/cavities_peaks_report}
	\caption[Relation between the maximum velocity above the second cavity and 
	the distance between the cavities]{Relation between the maximum velocity in the peak above the second cavity and the distance $d$ between the cavities.}
	\label{fig:velpeaks}
\end{figure}
We see that if $d < d_{rec}$ the velocity is affected by the presence of 
the first cavity, reducing its value. For $d>d_{rec}$ the velocity is 
slightly decreasing as $d$ increases; this fact can be interpreted as the 
effect of the turbulence that 
is generated near the end of the first cavity. As it can be seen in 
Figure~\ref{fig:kd1}, the turbulent kinetic energy that is produced from the 
first cavity is transported towards the second one, leading to an increased 
thickness of the boundary layer as we move in the $x$-direction.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth,% trim={0 0 0 7cm}, clip 
	]{cavities_dist1_k_report.png}
	\caption[Turbulen kinetic energy in the cavities problem]{Turbulent kinetic energy [$\si{m^2/s^2}$] around the cavities with $d=\SI{1}{m}$, at $t=T$. $Re=\num{6e5}$.}
	\label{fig:kd1}
\end{figure}
%
\subsubsection{Coupled problem with shallow cavities}
In this second test we simulate the same situation as in the previous 
single-domain test, 
choosing a distance between the two shallow cavities $d=\SI{1}{m}$, so that they do not influence each other directly. In addition to this, we couple the free-flow with the simulation of a flow inside a porous-medium that fills the space between 
the cavities, as it is shown in Figure~\ref{fig:multidomain}. In this way, we 
have two domains, $\Omega_\text{ff}$ and $\Omega_\text{pm}$, that are in contact through the 
interface $\Gamma_\text{int}$. The considered fluid is always isothermal, single-phase and single-component and gravity is neglected, as in the previous cases.

We want to analyse the differences that the presence of the porous-medium 
induces in the flow field with respect to the previous case and study how they 
change while we vary the permeability.

In the domain $\Omega_\text{ff}$ we solve, as before, the RANS equations with the 
$k\text{-}\omega$ model, while in the $\Omega_\text{pm}$ we solve the continuity equation
for a porous-medium flow \eqref{eq:pmcontinuity}, exploiting the Forchheimer's law \eqref{eq:forch}, in which we neglect the gravity contribution.
We use the same initial and boundary conditions we used before, but this time 
we have to impose, in addition, the coupling conditions described in 
Section~\ref{sec:coupling} on the interface 
$\Gamma_\text{int}$ and no-flow conditions on the boundary $\Gamma_\text{base}$, fixing the normal flux, i.e. the $v$ component of the velocity to zero.
We employ the same time discretization and the same grid we used before in $\Omega_\text{ff}$ and we extend it in 
$\Omega_\text{pm}$ in a conforming way.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{cavities_multidomain_new.pdf}
	\caption[Domain change with respect to Figure~\ref{fig:singledomain} for the coupled problem with shallow cavities]{Domain change with respect to Figure~\ref{fig:singledomain} for the coupled problem with shallow cavities. The subdomain $\Omega_\text{pm}$ is introduced between the cavities.}
	\label{fig:multidomain}
\end{figure}

As we did in the previous case, we compare in Figure~\ref{fig:md_wall_velocities} the profiles of the $u$ component of the velocity at the position $y=h$ for several values of permeability. For values lower than $\SI{e-8}{m^2}$, the porous-medium results to be almost impermeable, or at least the flow field in $\Omega_\text{ff}$ is the 
same that we had in the previous test considering only the free-flow. The maximum velocities in the 
corner of the porous-medium are some orders of magnitude lower than those in 
the cavities (see Figure~\ref{fig:coupled_vel_3}).
\begin{figure}
	\centering
	\input{../img/cavities_coupled_velx_report}
	\caption[Profiles of the $u$ component of the velocity at $y=h$ in the coupled problem with shallow cavities]{Profiles of the $u$ component of the velocity at $y=h$ in the coupled problem with shallow cavities for several values of permeability, at $t=T$. $Re = \num{6e5}$.}
	\label{fig:md_wall_velocities}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{coupled_vel_3_report.png}
	\caption[Magnitude of the velocity field in the coupled problem with shallow cavities]{Magnitude of the velocity field $[\si{m/s}]$ in the coupled problem with shallow cavities, with $\mathrm{K}=\SI{3.1e-9}{m^2}$, at $t=T$. $Re=\num{6e5}$.}
	\label{fig:coupled_vel_3}
\end{figure}

Starting from $\mathrm{K}=\SI{3.1e-8}{m^2}$, we observe some changes in the velocity 
profile and increasing the permeability those changes are enhanced.
The increase of the maximum velocity in correspondence of the first cavity can 
be due to the reduction of the \emph{wall} behaviour of the porous-medium. The 
flow is allowed to reach higher velocities and it is less forced to reduce 
its velocity because a more relevant amount of fluid enters into the 
porous-medium (see Figure~\ref{fig:coupled_arrows}). Then this flow comes out 
from the top of $\Omega_\text{pm}$ within approximately the first 
$\SI{20}{cm}$; in the case of high permeability, this region with a peak in the 
$v$ component of the velocity spreads and 
moves a bit ahead, as it can be seen in Figure~\ref{fig:coupled_vel_split}.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{coupled_first_cavity_report_labels.png}
	\caption[Velocity field near the end of the first cavity in the coupled problem with shallow cavities]{Velocity field [$\si{m/s}$] near the end of the first cavity in the coupled problem with shallow cavities, with $\mathrm{K}=\SI{3.1e-7}{m^2}$, at $t=T$. A portion of fluid enters into the porous-medium. The dashed line is the interface $\Gamma_\text{int}$. The length of the arrows is not scaled. $Re=\num{6e5}$.}
	\label{fig:coupled_arrows}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{coupled_split_comparison_report.png}
	\caption[$v$ component of the velocity near the end of the first cavity in the coupled problem with shallow cavities]{$v$ component of the velocity [$\si{m/s}$] near the end of the first cavity in the free-flow domain $\Omega_\text{ff}$, $t=T$. $\mathrm{K} = \SI{3.1e-7}{m^2}$ on the left and $\mathrm{K} = \SI{3.1e-9}{m^2}$ on the right. $Re=\num{6e5}$.}
	\label{fig:coupled_vel_split}
\end{figure}

After the distance $d_{rec}$, the value of the velocity that was there 
before the effect of the cavity is recovered and the boundary layer is 
restored. With high values of permeability this value is higher than the one 
with low permeabilities; this is due to the Beavers-Joseph-Saffman condition 
\eqref{eq:bjs} at the interface, that allows more slip as the permeability 
increases. Eventually the behaviour around the 
second cavity is approximately the same with all the permeabilities. There is a 
portion of fluid that goes back inside the porous-medium, but, since it comes 
from the corner eddy, the values involved are lower compared to what happens in 
the first cavity, so this effect does not seem to influence the free-flow 
notably (see Figure~\ref{fig:coupledsecondcav}).
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{coupled_second_cavity_report_labels.png}
	\caption[Velocity field near the beginning of the second cavity in the coupled problem with shallow cavities]{Velocity field $[\si{m/s}]$ near the beginning of the second cavity in the coupled problem with shallow cavities, with $\mathrm{K}=\SI{3.1e-7}{m^2}$ at $t=T$. Some flow enters into the porous medium. The dashed line is the interface $\Gamma_\text{int}$. The length of the arrows is not scaled. $Re=\num{6e5}$.}
	\label{fig:coupledsecondcav}
\end{figure}

%It is interesting to evaluate the mass flow rate $\dot{m}$ across the interface between the free-flow and the porous-medium flow. In particular, we compute, at $t=T$, the amount of mass that goes from the free-flow region to the porous-medium per unit of time as:
%\begin{equation}
%	\dot{m} = \int_{\Gamma_\text{int}} \max \{\varrho \mathbf{v} \cdot \mathbf{n}, 0 \} \; dA,
%\end{equation}
%where $\mathbf{n}$ is the outward unit vector normal to $\partial \Omega_\text{ff}$. From Table~\ref{tab:mass} and Figure~\ref{fig:mass} we can observe a relevant increase when the permeability is greater than $\SI{e-8}{m^2}$ approximately, so we find the same threshold value of the previous analysis.
%\begin{table}
%	\centering
%	\[
%	\begin{array}{cc}
%	\toprule
%	\mathrm{K} \; [\si{m^2}] & \dot{m} \; [\si{kg/s}]\\
%	\midrule
%	\num{3.1e-12} & \num{6.401e-4}\\
%	\num{3.1e-9} & \num{7.673e-4}\\
%	\num{3.1e-8} & \num{1.389e-3}\\
%	\num{1.55e-7} & \num{2.271e-3}\\
%	\num{3.1e-7} & \num{2.690e-3}\\
%	\num{3.1e-6} & \num{4.207e-3}\\
%	\bottomrule
%	\end{array}
%	\]
%	\caption[Mass flow rate across $\Gamma_\text{int}$ depending on the permeability in the coupled test with shallow cavities]{Mass flow rate from the free-flow region to the porous-medium across $\Gamma_\text{int}$, depending on the permeability, in the coupled test with shallow cavities.}
%	\label{tab:mass}
%\end{table}
%\begin{figure}
%	\centering
%	\input{../img/mass_exchange}
%	\caption[Mass flow rate across $\Gamma_\text{int}$ depending on the permeability in the coupled test with shallow cavities]{Mass flow rate from the free-flow region to the porous-medium across $\Gamma_\text{int}$, depending on the permeability, in the coupled test with shallow cavities.}
%	\label{fig:mass}	
%\end{figure}
%
\subsubsection{Coupled problem with deep cavities}
We repeat the previous test considering the domain with deep cavities depicted in Figure~\ref{fig:multidomain_deep}, such that $h=\SI{0.3}{m}$. The grid is extended uniformly.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{cavities_multidomain_deep.pdf}
	\caption[Domain change with respect to Figure~\ref{fig:singledomain} for the coupled problem with deep cavities]{Domain change with respect to Figure~\ref{fig:singledomain} for the coupled problem with deep cavities. The subdomain $\Omega_\text{pm}$ is introduced between the cavities.}
	\label{fig:multidomain_deep}
\end{figure}
Using the same model and the same boundary and interface conditions, we want to see if, with a different height of the cavities, the porous-medium flow affects differently the flow field. As before, we vary the permeability of the porous-medium in order to understand which is the threshold value between a permeable and an almost impermeable behaviour.

In Figure~\ref{fig:coupled_vel_deep}, we can see the magnitude of the velocity field in the region around the cavities and the porous-medium. As before, the two cavities show the same recirculation pattern, but it is different from the one that is generated when the cavities are shallow (see Figure~\ref{fig:coupled_vel_3}), because of the different size of the domain. Here, there is a bigger circular eddy touching the right boundary of the cavity and some smaller eddies in the left region of the cavity. 
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{coupled_deep_vel.png}
	\caption[Magnitude of the velocity field in the coupled problem with deep cavities]{Magnitude of the velocity field $[\si{m/s}]$ in the coupled problem with deep cavities, with $\mathrm{K}=\SI{3.1e-9}{m^2}$, at $t=T$. $Re=\num{6e5}$.}
	\label{fig:coupled_vel_deep}
\end{figure}

In Figure~\ref{fig:md_wall_velocities_deep}, we compare the profiles of the $u$ component of the velocity at the position $y=h$, for several values of permeability. With respect to Figure~\ref{fig:md_wall_velocities}, we observe a different profile in correspondence of the cavities, because of the different recirculation pattern inside them. As before, we notice that, as the permeability increases, the maximum velocity in correspondence of the first cavity increases, the minimum velocity above the beginning of the porous-medium decreases and the velocity above the end of the porous-medium increases. The threshold value for the permeability of approximately $\SI{e-8}{m^2}$ seems to be still valid. With respect to the previous test case, we observe that the value of the velocity before the second cavity, for $5 < x < 5.5$, increases faster. In fact, when $\mathrm{K} = \SI{3.1e-7}{m^2}$, it is greater than $\SI{0.3}{m/s}$, while in the previously, for the same value of permeability, it was approximately $\SI{0.27}{m/s}$. This fact could be due to a smaller amount of fluid exchanged with the porous-medium, or at least to differently distributed exchanges along the interface.
\begin{figure}
	\centering
	\input{../img/cavities_coupled_velx_deep}
	\caption[Profiles of the $u$ component of the velocity at $y=h$ in the coupled problem with deep cavities]{Profiles of the $u$ component of the velocity at $y=h$ in the coupled problem with deep cavities for several values of permeability, at $t=T$. $Re = \num{6e5}$.}
	\label{fig:md_wall_velocities_deep}
\end{figure}

In Figure~\ref{fig:coupled_first_deep} we see the velocity field around the first cavity. A portion of flow enters into the porous-medium near its upper-left corner, then it exits from above as in the case of shallow cavities.
The section of $\Gamma_\text{int}$ such that $y<h/2$ is characterized by a more complex behaviour for what concerns the flow direction. In fact, because of the multiple eddies, the exchange of fluid occurs both from the free-flow region to the porous-medium and vice versa.
In Figure~\ref{fig:coupledsecondcav_deep} we see the velocity field around the second cavity. Here, the flow pattern across the interface is analogous to the one in the case of shallow cavities, depicted in Figure~\ref{fig:coupledsecondcav}.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{cav_deep_first3_labels.png}
	\caption[Velocity field around the first cavity in the coupled problem with deep cavities]{Velocity field [$\si{m/s}$] around the first cavity in the coupled problem with deep cavities, with $\mathrm{K}=\SI{3.1e-7}{m^2}$, at $t=T$. The dashed line is the interface $\Gamma_\text{int}$. The length of the arrows is not scaled. $Re=\num{6e5}$.}
	\label{fig:coupled_first_deep}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{cav_deep_second_labels.png}
	\caption[Velocity field around the second cavity in the coupled problem with deep cavities]{Velocity field $[\si{m/s}]$ around the second cavity in the coupled problem with deep cavities, with $\mathrm{K}=\SI{3.1e-7}{m^2}$ at $t=T$. The dashed line is the interface $\Gamma_\text{int}$. The length of the arrows is not scaled. $Re=\num{6e5}$.}
	\label{fig:coupledsecondcav_deep}
\end{figure}

It is interesting to evaluate the mass flow rate $\dot{m}$ across the interface between the free-flow and the porous-medium flow. In particular, we compute, at $t=T$, the amount of mass that goes from the free-flow region to the porous-medium per unit of time as:
\begin{equation}
\dot{m} = \int_{\Gamma_\text{int}} \max \{\varrho \mathbf{v} \cdot \mathbf{n}, 0 \} \; dA,
\end{equation}
where $\mathbf{n}$ is the outward unit vector normal to $\partial \Omega_\text{ff}$. Notice that, being the fluid incompressible and imposing no-flow conditions on the lower boundary of the porous-medium $\Gamma_\text{base}$, the net mass flow rate across $\Gamma_\text{int}$ is zero.

In Figure~\ref{fig:mass} we compare the values in the two cases of shallow and deep cavities. In both the situations we observe a relevant increase of the mass flow rate when the permeability is approximately greater than $\SI{e-8}{m^2}$, so the same threshold value that we found in the previous analysis. $\dot{m}$ is always greater in the case of deep cavities than in the case of shallow cavities. In Table~\ref{tab:mass} we compare the values and we compute the ratio $\dot{m}_\text{deep} / \dot{m}_\text{shallow}$, that results to be between $1.3$ and $1.5$ for every value of permeability. The ratio between the measure of the $\Gamma_\text{int}$ is $1.6 / 1.2 = 1.\bar{3}$, so it is likely that the difference in the mass flow rate between the two cases is simply due to the different extension of the interface.
\begin{figure}
	\centering
	\input{../img/mass_exchange_comp}
	\caption[Mass flow rate across $\Gamma_\text{int}$ depending on the permeability]{Mass flow rate from the free-flow region to the porous-medium across $\Gamma_\text{int}$, depending on the permeability.}
	\label{fig:mass}	
\end{figure}
\begin{table}
	\centering
	\[
	\begin{array}{cccc}
	\toprule
	\mathrm{K} \; [\si{m^2}] & \dot{m}_\text{deep} \; [\si{kg/s}] & \dot{m}_\text{shallow} \; [\si{kg/s}] & \dot{m}_\text{deep} / \dot{m}_\text{shallow}\\
	\midrule
	\num{3.1e-12} & \num{9.455e-4} & \num{6.401e-4} & 1.477\\
	\num{3.1e-9} & \num{1.083e-3} & \num{7.673e-4} & 1.411\\
	\num{3.1e-8} & \num{1.812e-3} & \num{1.389e-3} & 1.304\\
	\num{1.55e-7} & \num{3.063e-3} & \num{2.271e-3} & 1.349\\
	\num{3.1e-7} & \num{3.805e-3} & \num{2.690e-3} & 1.414\\
%	\num{3.1e-6} & \num{4.207e-3}\\
	\bottomrule
	\end{array}
	\]
	\caption[Mass flow rate across $\Gamma_\text{int}$ depending on the permeability]{Mass flow rate from the free-flow region to the porous-medium across $\Gamma_\text{int}$, depending on the permeability.}
	\label{tab:mass}
\end{table}
%\begin{table}
%	\centering
%	\[
%	\begin{array}{cc}
%	\toprule
%	\mathrm{K} \; [\si{m^2}] & \dot{m} \; [\si{kg/s}]\\
%	\midrule
%	\num{3.1e-12} & \num{9.455e-4}\\
%	\num{3.1e-9} & \num{1.083e-3}\\
%	\num{3.1e-8} & \num{1.812e-3}\\
%	\num{1.55e-7} & \num{3.063e-3}\\
%	\num{3.1e-7} & \num{3.805e-3}\\
%	\bottomrule
%	\end{array}
%	\]
%	\caption[Mass flow rate across $\Gamma_\text{int}$ depending on the permeability in the coupled test with deep cavities]{Mass flow rate from the free-flow region to the porous-medium across $\Gamma_\text{int}$, depending on the permeability, in the coupled test with deep cavities.}
%	\label{tab:mass_deep}
%\end{table}
%\begin{figure}
%	\centering
%	\input{../img/mass_exchange_deep}
%	\caption[Mass flow rate across $\Gamma_\text{int}$ depending on the permeability in the coupled test with deep cavities]{Mass flow rate from the free-flow region to the porous-medium across $\Gamma_\text{int}$, depending on the permeability, in the coupled test with deep cavities.}
%	\label{fig:mass_deep}	
%\end{figure}
\subsection{Obstacle problem}
In this subsection we study the behaviour of
%an isothermal, single-phase, single-component
a turbulent flow in a channel with a porous obstacle of height $h=\SI{0.1}{m}$ on the lower boundary, as depicted in Figure~\ref{fig:obstacle_domain}. We want to analyse how the porous-medium affects the flow field, considering several possible values of permeability.
We solve the RANS equations \eqref{eq:ransmass}-\eqref{eq:ransmom} with the $k\text{-}\omega$ turbulence model \eqref{eq:komegak}-\eqref{eq:komegaomega} in the subdomain $\Omega_\text{ff}$ and the continuity equation for a porous-medium flow \eqref{eq:pmcontinuity}, exploiting the Forchheimer's law \eqref{eq:forch}, in the subdomain $\Omega_\text{pm}$. We neglect the gravity contributions.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{obstacle_domain2.pdf}
	\caption[Domain for the obstacle problem]{Domain for the obstacle problem.}
	\label{fig:obstacle_domain}
\end{figure}
We impose inflow boundary conditions on the left boundary $\Gamma_\text{in}$:
\begin{equation}
\mathbf{v} = \mathbf{v}_\text{in} = [u_\text{in}, 0]^\mathrm{T}, \quad u_\text{in} = \SI{1}{m/s},
\end{equation}
no-slip boundary conditions on the lower boundary $\Gamma_w$, symmetry boundary conditions on the upper boundary $\Gamma_\text{sym}$ and outflow boundary conditions on the right boundary $\Gamma_\text{out}$, fixing the value of the pressure:
\begin{equation}
	p = p_\text{ext} = \SI{1.1e5}{\pascal}.
\end{equation}
On the interface $\Gamma_\text{int}$, we impose the coupling conditions described in Section~\ref{sec:coupling}, while on the boundary $\Gamma_\text{base}$ we impose no-flow conditions.
The density of the fluid is $\varrho = \SI{1}{kg/m^3}$ and its kinematic viscosity is $\nu=\SI{e-5}{m^2/s}$, so that the Reynolds number is $Re=\num{6e5}$. We start considering a permeability $\mathrm{K}=\SI{e-9}{m^2}.$ We simulate the time interval $(0,T) $, with $T=\SI{30}{s}$, such that the solution reaches an equilibrium, and we use an initial time-step $\Delta t = \SI{e-4}{s}$. As initial condition we set:
\begin{equation}
	\mathbf{v} = [u_\text{init}, 0]^\mathrm{T} \quad \forall \mathbf{x} \in \Omega_\text{ff}, \quad u_\text{init} =
	\begin{cases}
	u_\text{in} \quad&\text{if $x\leq 0 \lor x > \SI{1}{m}$}\\
	\frac{7}{6}u_\text{in} \quad&\text{if $0 \leq x \leq \SI{1}{m}$}\\
	\end{cases},
\end{equation}
\begin{equation}
	p = p_\text{ext} \quad \forall \mathbf{x} \in \Omega_\text{ff} \cup \Omega_\text{pm},
\end{equation}
\begin{equation}
	k = k_\text{in}, \; \omega = \omega_\text{in} \quad \forall \mathbf{x} \in \Omega_\text{ff}.
\end{equation}
The factor $7/6$ ensures that the flow rate is uniform along the channel.
Performing a sensitivity analysis, we choose a grid made of $\num{280x82}$ cells, employing gradings up to $1.2$ in order ho have refined cells near the walls. 
The size of the cells in the region around the upper-left corner of the obstacle shows to affect significantly the solution. In fact, looking at Figure~\ref{fig:obstacle_grid}, we can see how the pattern of the velocity field changes for three different grids.
\begin{figure}
	\centering
	\subfloat[]{\includegraphics[width=0.32\textwidth]{obstacle_grid4.png}\label{fig:grid4}}\hspace{0.008\textwidth}
	\subfloat[]{\includegraphics[width=0.32\textwidth]{obstacle_grid3.png}\label{fig:grid3}}\hspace{0.008\textwidth}
	\subfloat[]{\includegraphics[width=0.32\textwidth]{obstacle_grid2.png}\label{fig:grid2}}
	\caption[short text]{Magnitude of the velocity field $[\si{m/s}]$ near the beginning of the porous-medium, at $t=T$, considering a grid of
	\protect\subref{fig:grid4} $\num{207x52}$ cells, with minimum cell size at the obstacle corner equal to $\SI{3.3x4.4}{mm}$, 
	\protect\subref{fig:grid3} $\num{242x68}$ cells, with minimum cell size at the obstacle corner equal to $\SI{2x2.7}{mm}$,
	\protect\subref{fig:grid2} $\num{280x82}$ cells, with minimum cell size at the obstacle corner equal to $\SI{1.4x2}{mm}$.	
	$Re=\num{6e5}$.}
	\label{fig:obstacle_grid}
\end{figure}

In Figure~\ref{fig:obstacle_begin}, we can see the velocity field near the beginning of the porous obstacle. At the frontal face of the porous-medium, a small portion of the main flow enters into the obstacle, while the left amount of fluid recirculates near the bottom of the channel. At the corner of the porous-medium, the flow is deflected towards an higher region, so that, at the upper surface of the obstacle, a recirculation is generated and the velocity at the porous wall is negative.
In Figure~\ref{fig:obstacle_end}, we can see, instead, the velocity field near the end of the obstacle. The velocity pattern is analogous to the one generated by a backward facing step, as studied in Section~\ref{sec:bfs}. There is a small amount of fluid exiting from the porous-medium, but it does not seem to affect the eddies in the region after the obstacle.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{obstacle_begin_vel_labels.png}
	\caption[Velocity field near the beginning of the obstacle in the obstacle problem]{Velocity field $[\si{m/s}]$ near the beginning of the obstacle in the obstacle problem, with $\mathrm{K} = \SI{e-9}{m^2}$ at $t=T$.
	The dashed line is the interface.
	The length of the arrows is not scaled. $Re = \num{6e5}$.}
	\label{fig:obstacle_begin}
\end{figure}
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{obstacle_end_vel2_labels.png}
	\caption[Velocity field near the end of the obstacle in the obstacle problem]{Velocity field $[\si{m/s}]$ near the end of the obstacle in the obstacle problem, with $\mathrm{K} = \SI{e-9}{m^2}$ at $t=T$.
	The dashed line is the interface.
	The length of the arrows is not scaled. $Re = \num{6e5}$.}
	\label{fig:obstacle_end}
\end{figure}

Now we analyse how a change in the permeability of the porous obstacle influences the flow field, considering a range from $\SI{e-11}{m^2}$ to $\SI{e-8}{m^2}$.

In Figure~\ref{fig:obstacle_diff} we can see the magnitude of the difference between the velocity field when $\mathrm{K}=\SI{e-8}{m^2}$ and $\mathrm{K}=\SI{e-11}{m^2}$. We observe that the most relevant differences are near the beginning of the obstacle, arising from the upper-left corner. Near the end of the obstacle, instead, the flow field is approximately the same.
\begin{figure}
	\centering
	\includegraphics[width=\textwidth]{obstacle_diff.png}
	\caption[Magnitude of the difference of the velocity field in the obstacle problem considering two values of permeability]{Magnitude of the difference of the velocity field $[\si{m/s}]$ in the obstacle problem between the cases $\mathrm{K}=\SI{e-8}{m^2}$ and $\mathrm{K}=\SI{e-11}{m^2}$.}
	\label{fig:obstacle_diff}
\end{figure}
\begin{figure}
	\centering
	\subfloat[$u$ component]{\includegraphics[width=0.4\textwidth]{obstacle_pm_diff_x.png}}\hspace{2cm}
	\subfloat[$v$ component]{\includegraphics[width=0.4\textwidth]{obstacle_pm_diff_y.png}}
	\caption[Difference of the velocity field at the beginning of the porous obstacle between two values of permeability]{Components of the difference $\mathbf{v}_8 - \mathbf{v}_{11}$ $[\si{m/s}]$ at the beginning of the porous obstacle, where $\mathbf{v}_n$ is the velocity field computed considering a permeability $\mathrm{K}=10^{-n}\;\si{m^2}$.}
	\label{fig:obstacle_pm_diff}
\end{figure}
\begin{figure}
	\centering
	\input{../img/obstacle_velx}
	\caption[Profiles of the $u$ component of the velocity above the porous obstacle]{Profiles of the $u$ component of the velocity at $y=h$, i.e. above the porous obstacle, which occupies the region $4.5 < x < 5.5$. $t=T$, $Re=\num{6e5}$.}
	\label{fig:obstacle_velx}
\end{figure}
In Figure~\ref{fig:obstacle_diff} we observe the components of the same velocity difference, at the beginning of the porous-medium domain. The area around the upper-left corner is the one with the greatest difference. In particular, when $\mathrm{K} = \SI{e-8}{m^2}$, both components of the velocity are higher, so that more fluid coming from the free-flow region \emph{crosses} the corner of the porous obstacle and exits from above.
In Figure~\ref{fig:obstacle_velx}, the profiles of the $u$ component of the velocity along the section at $y=h$, i.e. above the obstacle, are reported for different values of permeability. We observe negative values starting from $x=4.5$, corresponding to the recirculation above the porous-medium. As $\mathrm{K}$ increases, the minimum value of $u$ and the reattachment length, i.e. the point where the velocities becomes positive, increase. It is likely that, as a more relevant amount of fluid \emph{crosses} the corner of the porous-medium, the area where the flow is not only one point but is extended. As a result, the recirculation il slightly shifted in the flow direction, with the consequent increase of the reattachment length.
